<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/liudalogometal.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/liudalogometal.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/liudalogometal.png">
  <link rel="mask-icon" href="/images/liudalogometal.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ncepuee.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="记录科研生活">
<meta property="og:type" content="website">
<meta property="og:title" content="School boy">
<meta property="og:url" content="http://ncepuee.github.io/index.html">
<meta property="og:site_name" content="School boy">
<meta property="og:description" content="记录科研生活">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="菜菜的黄">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://ncepuee.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>School boy</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">School boy</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">不妄动，不滥言，不苟求，不虚行</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="菜菜的黄"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">菜菜的黄</p>
  <div class="site-description" itemprop="description">记录科研生活</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ncepuee" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ncepuee" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/ncepuee" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ncepuee" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://ncepuee.github.io/2021/09/05/20210830-0905/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="菜菜的黄">
      <meta itemprop="description" content="记录科研生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="School boy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/05/20210830-0905/" class="post-title-link" itemprop="url">20210830-0905周报</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-05 08:00:00" itemprop="dateCreated datePublished" datetime="2021-09-05T08:00:00+08:00">2021-09-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="每周音乐🎵"><a href="#每周音乐🎵" class="headerlink" title="每周音乐🎵"></a>每周音乐🎵</h2><iframe frameborder="0" height="80" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;" src="//music.163.com/outchain/player?type=2&id=461347998&auto=1&height=66"></iframe>

<h2 id="运动歌单🏃‍"><a href="#运动歌单🏃‍" class="headerlink" title="运动歌单🏃‍"></a>运动歌单🏃‍</h2><p>适合跑步运动的歌单（Music）</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="450" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/playlist/running-fitness-sports/pl.u-Ldbqel5u27kmjlm"></iframe>

<h2 id="学习进展✍"><a href="#学习进展✍" class="headerlink" title="学习进展✍"></a>学习进展✍</h2><h3 id="星期一"><a href="#星期一" class="headerlink" title="星期一"></a>星期一</h3><p>普中科技B站视频的第六讲工程模版的创建，一个完整的基础工程有哪些文件所构成？</p>
<p>1、首先需要仿真调试或者flash烧写所需的.cmd文件和DSP的nonBIOS.cmd文件。</p>
<p>2、其次需要我们使用的芯片的.ccxml目标配置文件。</p>
<p>3、芯片内核及外设.c源文件，比如DSP2833x_Gpio.c等</p>
<p>4、芯片内核及外设.h头文件，比如DSP2833x_Gpio.h等</p>
<p>5、DSP .lib库文件，常用的如IQmath.lib等。</p>
<p>发现手把手第86页有个错误：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HISPCP/LOSPCP prescale register settings, normally it will be set to default values</span></span><br><span class="line">SysCtrlRegs.HISPCP.all = <span class="number">0x0001</span>;</span><br><span class="line">SysCtrlRegs.LOSPCP.all = <span class="number">0x0002</span>;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://tva1.sinaimg.cn/large/0084Tjdoly1gu4w6r5n0uj60wb0nftlm02.jpg" alt="image"></p>
<p>高速外设时钟频率是对系统频率进行2分频，即为150/2=75MHz；同理，可以求得低速外设时钟频率为37.5MHz；</p>
<h3 id="对系统时钟的理解"><a href="#对系统时钟的理解" class="headerlink" title="对系统时钟的理解"></a>对系统时钟的理解</h3><p>所谓PLL电路，就是锁相环电路(Phase-Locked Loop)。电路通过比较复杂的原理可以将低频信号进行倍频与分频处理。F28335的工作最高频率为150MHz，而一般在电路设计中，一般采用的晶振频率为30MHz。之所以不直接采用150MHz晶振，一方面是价格高昂，另一方面还要对电路做EMI处理。<strong>因此，为了让DSP能够工作在最高频率，需要对晶振信号频率进行5倍频处理。通常采用的方案是通过PLL电路先进行10倍频处理，再2分频处理。</strong></p>
<p>通常用PLL来产生倍频，倍频有2、4、6、8、10这几个等级，那么我们要让CPU运行在150MHz，通常选用的倍频是10，这样通过PLL出来的VCOCLK的频率为300MHz，但是不能让300MHz直接进入CPU，而是要对其再进行分频，PLLSTS.DIVSEL设置为2分频，这样CLKIN就是150MHz，即系统的时钟频率为150MHz。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitPll</span><span class="params">(Uint16 val, Uint16 divsel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Make sure the PLL is not running in limp mode</span></span><br><span class="line">   <span class="keyword">if</span> (SysCtrlRegs.PLLSTS.bit.MCLKSTS != <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="comment">// Missing external clock has been detected</span></span><br><span class="line">      <span class="comment">// Replace this line with a call to an appropriate</span></span><br><span class="line">      <span class="comment">// SystemShutdown(); function.</span></span><br><span class="line">      <span class="keyword">asm</span>(<span class="string">&quot;        ESTOP0&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// DIVSEL MUST be 0 before PLLCR can be changed from</span></span><br><span class="line">   <span class="comment">// 0x0000. It is set to 0 by an external reset XRSn</span></span><br><span class="line">   <span class="comment">// This puts us in 1/4</span></span><br><span class="line">   <span class="keyword">if</span> (SysCtrlRegs.PLLSTS.bit.DIVSEL != <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       EALLOW;</span><br><span class="line">       SysCtrlRegs.PLLSTS.bit.DIVSEL = <span class="number">0</span>;</span><br><span class="line">       EDIS;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Change the PLLCR</span></span><br><span class="line">   <span class="keyword">if</span> (SysCtrlRegs.PLLCR.bit.DIV != val)</span><br><span class="line">   &#123;</span><br><span class="line"></span><br><span class="line">      EALLOW;</span><br><span class="line">      <span class="comment">// Before setting PLLCR turn off missing clock detect logic</span></span><br><span class="line">      SysCtrlRegs.PLLSTS.bit.MCLKOFF = <span class="number">1</span>;</span><br><span class="line">      SysCtrlRegs.PLLCR.bit.DIV = val;</span><br><span class="line">      EDIS;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Optional: Wait for PLL to lock.</span></span><br><span class="line">      <span class="comment">// During this time the CPU will switch to OSCCLK/2 until</span></span><br><span class="line">      <span class="comment">// the PLL is stable.  Once the PLL is stable the CPU will</span></span><br><span class="line">      <span class="comment">// switch to the new PLL value.</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// This time-to-lock is monitored by a PLL lock counter.</span></span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="comment">// Code is not required to sit and wait for the PLL to lock.</span></span><br><span class="line">      <span class="comment">// However, if the code does anything that is timing critical,</span></span><br><span class="line">      <span class="comment">// and requires the correct clock be locked, then it is best to</span></span><br><span class="line">      <span class="comment">// wait until this switching has completed.</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Wait for the PLL lock bit to be set.</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// The watchdog should be disabled before this loop, or fed within</span></span><br><span class="line">      <span class="comment">// the loop via ServiceDog().</span></span><br><span class="line"></span><br><span class="line">	  <span class="comment">// Uncomment to disable the watchdog</span></span><br><span class="line">      DisableDog();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span>(SysCtrlRegs.PLLSTS.bit.PLLLOCKS != <span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">	      <span class="comment">// Uncomment to service the watchdog</span></span><br><span class="line">          <span class="comment">// ServiceDog();</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      EALLOW;</span><br><span class="line">      SysCtrlRegs.PLLSTS.bit.MCLKOFF = <span class="number">0</span>;</span><br><span class="line">      EDIS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If switching to 1/2</span></span><br><span class="line">	<span class="keyword">if</span>((divsel == <span class="number">1</span>)||(divsel == <span class="number">2</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		EALLOW;</span><br><span class="line">	    SysCtrlRegs.PLLSTS.bit.DIVSEL = divsel;</span><br><span class="line">	    EDIS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// If switching to 1/1</span></span><br><span class="line">	<span class="comment">// * First go to 1/2 and let the power settle</span></span><br><span class="line">	<span class="comment">//   The time required will depend on the system, this is only an example</span></span><br><span class="line">	<span class="comment">// * Then switch to 1/1</span></span><br><span class="line">	<span class="keyword">if</span>(divsel == <span class="number">3</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		EALLOW;</span><br><span class="line">	    SysCtrlRegs.PLLSTS.bit.DIVSEL = <span class="number">2</span>;</span><br><span class="line">	    DELAY_US(<span class="number">50L</span>);</span><br><span class="line">	    SysCtrlRegs.PLLSTS.bit.DIVSEL = <span class="number">3</span>;</span><br><span class="line">	    EDIS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="关于DSP系统时钟的一些理解与修改"><a href="#关于DSP系统时钟的一些理解与修改" class="headerlink" title="关于DSP系统时钟的一些理解与修改"></a>关于DSP系统时钟的一些理解与修改</h3><p><img data-src="https://tvax2.sinaimg.cn/large/0084Tjdoly1gu4w7qrtwtj616s0o2awj02.jpg" alt="image"></p>
<p>系统时钟是在InitSysCtrl();进行初始化的，进入这个函数，系统初始化函数默认不使用看门狗。</p>
<p>高速时钟和低速时钟的分频初始化设置是↓↓</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SysCtrlRegs.HISPCP.all = <span class="number">0x0001</span>;</span><br><span class="line">SysCtrlRegs.LOSPCP.all = <span class="number">0x0002</span>;</span><br></pre></td></tr></table></figure>
<p>即高速时钟默认为系统时钟的二分频，低速时钟默认为系统时钟的四分频。</p>
<p><strong>可以发现，高速外设时钟频率是对系统频率进行2分频，即为150/2=75MHz;同理，可以求得低速外设时钟频率为150/4=37.5MHz；</strong></p>
<p>初始化高速和低速时钟之后，将外设的时钟进行使能，一般默认都是使能的。外设时钟控制寄存器有三个寄存器PCLKCR0、PCLKCR1、PCLKCR3，不同的外设时钟控制寄存器。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitPeripheralClocks</span><span class="params">(<span class="keyword">void</span>)</span><span class="comment">//初始化外设时钟</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   EALLOW;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HISPCP/LOSPCP prescale register settings, normally it will be set to default values</span></span><br><span class="line">   SysCtrlRegs.HISPCP.all = <span class="number">0x0001</span>;</span><br><span class="line">   SysCtrlRegs.LOSPCP.all = <span class="number">0x0002</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// XCLKOUT to SYSCLKOUT ratio.  By default XCLKOUT = 1/4 SYSCLKOUT</span></span><br><span class="line">   <span class="comment">// XTIMCLK = SYSCLKOUT/2</span></span><br><span class="line">   XintfRegs.XINTCNF2.bit.XTIMCLK = <span class="number">1</span>;</span><br><span class="line">   <span class="comment">// XCLKOUT = XTIMCLK/2</span></span><br><span class="line">   XintfRegs.XINTCNF2.bit.CLKMODE = <span class="number">1</span>;</span><br><span class="line">   <span class="comment">// Enable XCLKOUT</span></span><br><span class="line">   XintfRegs.XINTCNF2.bit.CLKOFF = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Peripheral clock enables set for the selected peripherals.</span></span><br><span class="line"><span class="comment">// If you are not using a peripheral leave the clock off</span></span><br><span class="line"><span class="comment">// to save on power.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Note: not all peripherals are available on all 2833x derivates.</span></span><br><span class="line"><span class="comment">// Refer to the datasheet for your particular device.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This function is not written to be an example of efficient code.</span></span><br><span class="line"></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.ADCENCLK = <span class="number">1</span>;    <span class="comment">// ADC</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// *IMPORTANT*</span></span><br><span class="line">   <span class="comment">// The ADC_cal function, which  copies the ADC calibration values from TI reserved</span></span><br><span class="line">   <span class="comment">// OTP into the ADCREFSEL and ADCOFFTRIM registers, occurs automatically in the</span></span><br><span class="line">   <span class="comment">// Boot ROM. If the boot ROM code is bypassed during the debug process, the</span></span><br><span class="line">   <span class="comment">// following function MUST be called for the ADC to function according</span></span><br><span class="line">   <span class="comment">// to specification. The clocks to the ADC MUST be enabled before calling this</span></span><br><span class="line">   <span class="comment">// function.</span></span><br><span class="line">   <span class="comment">// See the device data manual and/or the ADC Reference</span></span><br><span class="line">   <span class="comment">// Manual for more information.</span></span><br><span class="line"></span><br><span class="line">   ADC_cal();</span><br><span class="line"></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.I2CAENCLK = <span class="number">1</span>;   <span class="comment">// I2C</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.SCIAENCLK = <span class="number">1</span>;   <span class="comment">// SCI-A</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.SCIBENCLK = <span class="number">1</span>;   <span class="comment">// SCI-B</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.SCICENCLK = <span class="number">1</span>;   <span class="comment">// SCI-C</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.SPIAENCLK = <span class="number">1</span>;   <span class="comment">// SPI-A</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.MCBSPAENCLK = <span class="number">1</span>; <span class="comment">// McBSP-A</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.MCBSPBENCLK = <span class="number">1</span>; <span class="comment">// McBSP-B</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.ECANAENCLK=<span class="number">1</span>;    <span class="comment">// eCAN-A</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.ECANBENCLK=<span class="number">1</span>;    <span class="comment">// eCAN-B</span></span><br><span class="line"></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.TBCLKSYNC = <span class="number">0</span>;   <span class="comment">// Disable TBCLK within the ePWM</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EPWM1ENCLK = <span class="number">1</span>;  <span class="comment">// ePWM1</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EPWM2ENCLK = <span class="number">1</span>;  <span class="comment">// ePWM2</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EPWM3ENCLK = <span class="number">1</span>;  <span class="comment">// ePWM3</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EPWM4ENCLK = <span class="number">1</span>;  <span class="comment">// ePWM4</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EPWM5ENCLK = <span class="number">1</span>;  <span class="comment">// ePWM5</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EPWM6ENCLK = <span class="number">1</span>;  <span class="comment">// ePWM6</span></span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.TBCLKSYNC = <span class="number">1</span>;   <span class="comment">// Enable TBCLK within the ePWM</span></span><br><span class="line"></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.ECAP3ENCLK = <span class="number">1</span>;  <span class="comment">// eCAP3</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.ECAP4ENCLK = <span class="number">1</span>;  <span class="comment">// eCAP4</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.ECAP5ENCLK = <span class="number">1</span>;  <span class="comment">// eCAP5</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.ECAP6ENCLK = <span class="number">1</span>;  <span class="comment">// eCAP6</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.ECAP1ENCLK = <span class="number">1</span>;  <span class="comment">// eCAP1</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.ECAP2ENCLK = <span class="number">1</span>;  <span class="comment">// eCAP2</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EQEP1ENCLK = <span class="number">1</span>;  <span class="comment">// eQEP1</span></span><br><span class="line">   SysCtrlRegs.PCLKCR1.bit.EQEP2ENCLK = <span class="number">1</span>;  <span class="comment">// eQEP2</span></span><br><span class="line"></span><br><span class="line">   SysCtrlRegs.PCLKCR3.bit.CPUTIMER0ENCLK = <span class="number">1</span>; <span class="comment">// CPU Timer 0</span></span><br><span class="line">   SysCtrlRegs.PCLKCR3.bit.CPUTIMER1ENCLK = <span class="number">1</span>; <span class="comment">// CPU Timer 1</span></span><br><span class="line">   SysCtrlRegs.PCLKCR3.bit.CPUTIMER2ENCLK = <span class="number">1</span>; <span class="comment">// CPU Timer 2</span></span><br><span class="line"></span><br><span class="line">   SysCtrlRegs.PCLKCR3.bit.DMAENCLK = <span class="number">1</span>;       <span class="comment">// DMA Clock</span></span><br><span class="line">   SysCtrlRegs.PCLKCR3.bit.XINTFENCLK = <span class="number">1</span>;     <span class="comment">// XTIMCLK</span></span><br><span class="line">   SysCtrlRegs.PCLKCR3.bit.GPIOINENCLK = <span class="number">1</span>;    <span class="comment">// GPIO input clock</span></span><br><span class="line"></span><br><span class="line">   EDIS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要对系统时钟频率进行修改，也就是InitPll函数，函数有两个参数：val和divsel，val是用来设置PLL的倍频系数，divsel是用来设置分频系数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InitPll(DSP28_PLLCR,DSP28_DIVSEL);</span><br><span class="line">----------</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitPll</span><span class="params">(Uint16 val, Uint16 divsel)</span></span></span><br></pre></td></tr></table></figure>
<p>InitPll函数将DSP_PLLCR传递给val，将DSP_DIVSEL传递给divsel。</p>
<p>按住Ctrl点击DSP_PLLCR，就可以发现DSP_PLLCR的值设置的是10：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DSP28_PLLCR  10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  0 // PLL is bypassed in this mode</span></span><br></pre></td></tr></table></figure>
<p>按住Ctrl点击DSP_DIVSEL，就可以发现DSP_DIVSEL的值设置的是2：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#define DSP28_DIVSEL  0  // Enable /4 for SYSCLKOUT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_DIVSEL  1 // Disable /4 for SYSCKOUT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DSP28_DIVSEL   2 <span class="comment">// Enable /2 for SYSCLKOUT</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_DIVSEL   3 // Enable /1 for SYSCLKOUT</span></span><br></pre></td></tr></table></figure>
<p>即将晶振频率30MHz通过PLL倍频10倍后，再分频2倍，即系统时钟频率默认是150MHz。</p>
<p>所以使用Ti默认提供的系统初始化函数InitSysCtrl()，调用的c文件为DSP2833x_SysCtrl.c，初始化之后的频率是经过PLL10倍频后再分频2倍，得到系统时钟频率为150MHz。</p>
<h4 id="修改系统时钟"><a href="#修改系统时钟" class="headerlink" title="修改系统时钟"></a>修改系统时钟</h4><p>如果要修改系统时钟，让其不再是150MHz，那么我们就需要修改DSP_PLLCR和DSP_DIVSEL的值，比如设置DSP_PLLCR=3，DSP_DIVSEL=2，即：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#define DSP28_PLLCR  10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DSP28_PLLCR  3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_PLLCR  1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#define DSP28_DIVSEL  0  // Enable /4 for SYSCLKOUT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_DIVSEL  1 // Disable /4 for SYSCKOUT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DSP28_DIVSEL   2 <span class="comment">// Enable /2 for SYSCLKOUT</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DSP28_DIVSEL   3 // Enable /1 for SYSCLKOUT</span></span><br></pre></td></tr></table></figure>
<p>即晶振频率为30MHz，经过3倍频，2分频，系统时钟频率此时为45MHz。</p>
<h4 id="关于GPIO的理解学习"><a href="#关于GPIO的理解学习" class="headerlink" title="关于GPIO的理解学习"></a>关于GPIO的理解学习</h4><p><img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gu4w8yfqb8j616s15rb0a02.jpg" alt="image"></p>
<h3 id="星期二"><a href="#星期二" class="headerlink" title="星期二"></a>星期二</h3><p>数据类型的位数：</p>
<ul>
<li>float 是4字节，共32位</li>
<li>double 是8字节，64位</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/0684e6301db149c08904c9375a896996">定义数组版本的中断</a></p>
<p>EPWM3模块出现的问题：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">interrupt <span class="keyword">void</span> <span class="title">epwm3_isr</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//给三相参考波，tctr初值设置为0</span></span><br><span class="line">	ua=m*Vdc/<span class="built_in">sqrt</span>(<span class="number">3</span>)*<span class="built_in">cos</span>(<span class="number">100</span>*PI*tctr3);</span><br><span class="line">	ub=m*Vdc/<span class="built_in">sqrt</span>(<span class="number">3</span>)*<span class="built_in">cos</span>(<span class="number">100</span>*PI*tctr3<span class="number">-2</span>*PI/<span class="number">3</span>);</span><br><span class="line">	uc=m*Vdc/<span class="built_in">sqrt</span>(<span class="number">3</span>)*<span class="built_in">cos</span>(<span class="number">100</span>*PI*tctr3+<span class="number">2</span>*PI/<span class="number">3</span>);</span><br><span class="line">	cosne = (<span class="keyword">double</span>)<span class="number">2.0</span>/<span class="number">3</span>*(ua<span class="number">-0.5</span>*ub<span class="number">-0.5</span>*uc);</span><br><span class="line">	sinne = <span class="built_in">sqrt</span>(<span class="number">3</span>)/<span class="number">3</span>*(ub-uc);</span><br><span class="line">    <span class="comment">//将ua、ub、uc数组进行Clarke变换</span></span><br><span class="line">	u_alfa=cosne;</span><br><span class="line">	u_beta=sinne;</span><br><span class="line">    <span class="comment">//确定XYZ的值，详见自己的总结文档，这里的XYZ是标幺值</span></span><br><span class="line">    X1=u_beta;</span><br><span class="line">    Y1=<span class="number">0.867</span>*u_alfa<span class="number">-0.5</span>*u_beta;</span><br><span class="line">    Z1=<span class="number">-0.867</span>*u_alfa<span class="number">-0.5</span>*u_beta;</span><br><span class="line">    X=<span class="built_in">sqrt</span>(<span class="number">3</span>)*Ts/Vdc*X1;</span><br><span class="line">    Y=<span class="built_in">sqrt</span>(<span class="number">3</span>)*Ts/Vdc*Y1;</span><br><span class="line">    Z=<span class="built_in">sqrt</span>(<span class="number">3</span>)*Ts/Vdc*Z1;</span><br><span class="line">    <span class="comment">//用X、Y、Z可以判断扇区，sec=315462分别对应扇区123456</span></span><br><span class="line">    <span class="keyword">if</span>(X1&gt;<span class="number">0</span>) A=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> A=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(Y1&gt;<span class="number">0</span>) B=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> B=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(Z1&gt;<span class="number">0</span>) C=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> C=<span class="number">0</span>;</span><br><span class="line">    N=<span class="number">4</span>*C+<span class="number">2</span>*B+A;</span><br><span class="line">    <span class="comment">//将数字N转化成对应的扇区号</span></span><br><span class="line">    <span class="keyword">switch</span>(N)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: &#123;sec=<span class="number">2</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;sec=<span class="number">6</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: &#123;sec=<span class="number">1</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: &#123;sec=<span class="number">4</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: &#123;sec=<span class="number">3</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: &#123;sec=<span class="number">5</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据参考电压矢量所在的扇区确定标准矢量的作用时间</span></span><br><span class="line">    <span class="keyword">switch</span>(sec)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: &#123;t1=Y;  t2=X;  t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;t1=-Y; t2=-Z; t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: &#123;t1=X;  t2=Z;  t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: &#123;t1=-X; t2=-Y; t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: &#123;t1=Z;  t2=Y;  t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: &#123;t1=-Z; t2=-X; t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将T1、T2进行饱和处理</span></span><br><span class="line">    <span class="keyword">if</span>(t1+t2&gt;Ts)</span><br><span class="line">    &#123;</span><br><span class="line">    	t1=t1*Ts/(t1+t2);</span><br><span class="line">    	t2=t2*Ts/(t1+t2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义三个切换时刻Taon、Tbon、Tcon</span></span><br><span class="line">    Taon=t0/<span class="number">4</span>;</span><br><span class="line">    Tbon=t0/<span class="number">4</span>+t1/<span class="number">2</span>;</span><br><span class="line">    Tcon=t0/<span class="number">4</span>+t1/<span class="number">2</span>+t2/<span class="number">2</span>;</span><br><span class="line">    <span class="comment">//根据扇区给切换时刻Taon、Tbon、Tcon</span></span><br><span class="line">    <span class="keyword">switch</span>(sec)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: &#123;Ta=Taon; Tb=Tbon; Tc=Tcon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;Ta=Tbon; Tb=Taon; Tc=Tcon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: &#123;Ta=Tcon; Tb=Taon; Tc=Tbon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: &#123;Ta=Tcon; Tb=Tbon; Tc=Taon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: &#123;Ta=Tbon; Tb=Tcon; Tc=Taon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: &#123;Ta=Taon; Tb=Tcon; Tc=Tbon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    EPwm3Regs.CMPA.half.CMPA =Tc*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    EPwm3Regs.CMPB =Tc*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    tctr3=(<span class="keyword">double</span>)(tctr3+(<span class="keyword">double</span>)Ts);</span><br><span class="line">    k3++;</span><br><span class="line">	<span class="keyword">if</span>(tctr3&gt;=<span class="number">0.02</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		tctr3=<span class="number">0</span>;</span><br><span class="line">		k3=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//Voltage3[k3]=EPwm3Regs.CMPA.half.CMPA ;//观察用</span></span><br><span class="line">    Voltage3[k3]=Tc;</span><br><span class="line">	EPwm3Regs.ETCLR.bit.INT = <span class="number">1</span>;             <span class="comment">//清除标志位</span></span><br><span class="line">	PieCtrlRegs.PIEACK.all = PIEACK_GROUP3;  <span class="comment">//清除应答位</span></span><br><span class="line">	EINT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gu4wd9vzwnj616s0k8gr302.jpg" alt="image"> <img data-src="https://tvax1.sinaimg.cn/large/0084Tjdoly1gu4wdi67pwj616s0k8afj02.jpg" alt="image"> <img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gu4wdps8fdj316s0k879r.jpg" alt="image"></p>
<p>Ta、Tb、Tc的波形没有错，但是我调试发现k1、k2、k3不是同步变化，k1、k2是同步变化的。</p>
<h3 id="星期三"><a href="#星期三" class="headerlink" title="星期三"></a>星期三</h3><p>把昨天的问题和刘老师讨论之后，自己思考了下，ePWM3程序应该是没有问题，因为我将ePWM1模块的中断进行了屏蔽之后，只用ePWM2和ePWM3的中断，这样得出来的SVPWM波形是对的。</p>
<blockquote>
<p>如何将ePWM1的中断进行快速屏蔽：只需要将下面的几行代码注释即可；</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//interrupt void epwm1_isr(void);//声明EPWM1中断服务程序</span></span><br><span class="line"><span class="comment">//  PieVectTable.EPWM1_INT = &amp;epwm1_isr;//重新映射使用的中断向量，对应的地址P134页</span></span><br><span class="line"><span class="comment">//   PieCtrlRegs.PIEIER3.bit.INTx1 = 1;//允许PIE级中断INT3.1，即EPWM1中断</span></span><br></pre></td></tr></table></figure>
<p>红色的线接的是ePWM3模块的ePWMA，褐色的线接的是ePWM3模块的ePWMB，分别对应示波器的1路信号和2路信号，这里使用的示波器信号的线是Probe Comp，可以发现ePWM3模块的波形参考波是50Hz，PWM的频率显示是12.8kHz，与理解的是一致的，因为系统时钟是150MHz（30MHz晶振10倍频之后二分频），TBPRD=5859，Tpwm=12.8kHz;</p>
<p>但是如果不屏蔽ePWM1模块，那么会发现ePWM1和ePWM2模块的波形是对的，参考波的频率是50Hz，ePWM3模块的参考波的频率不是50Hz。PWM的频率还是12.8kHz。Debug发现k3不是和k1、k2同步变化的。如果两个中断同时来，那么会根据两者的中断优先级来判断哪个中断先执行，从而进入中断服务函数。如PWM1中断优先级比较高，则先进入PWM1的中断优先级，PWM2等待PWM1的中断服务函数执行完之后，再执行。如果两个中断不同时来的话，那么先到先执行。</p>
<p>问题分析：由于自己的中断太多，在三个ePWM的中断中有很多重复的运算，比如赋tctr1、2、3的初值，Clarke变换，扇区判断，最后计算的切换时刻Ta、Tb、Tc都是重复的运算，这样就造成了计算的冗余，导致28335的计算量太大，从而算力不够…</p>
<p>改进思路：那么我需要减少中断中重复计算的运算过程，所以思路就是在一个中断中，进入这个中断的时刻是当时基计数器TBCTR的值为0时进入，之后设置一个变量tctr，已经不再需要三个tctr进行时间计算了。这样只需要进行一次三相参考波计算，扇区判断，切换时刻Ta、Tb、Tc的计算，之后在一个中断中将Ta、Tb、Tc分别进行归一化处理，直接赋给ePWM1、ePWM2、ePWM3的比较寄存器。</p>
<h4 id="利用一个中断进行三相的计算"><a href="#利用一个中断进行三相的计算" class="headerlink" title="利用一个中断进行三相的计算"></a>利用一个中断进行三相的计算</h4><p>根据一个中断实现的SVPWM的思路，将DSP2833x_EPwm_1INT.c文件中，将ePWM2、ePWM3的中断进行屏蔽，只用ePWM1的中断：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.ETSEL.bit.INTEN = <span class="number">1</span>; <span class="comment">// ePWM1模块中断产生位，使能中断</span></span><br><span class="line">EPwm2Regs.ETSEL.bit.INTEN = <span class="number">0</span>; <span class="comment">// disable ePWM2 INT</span></span><br><span class="line">EPwm3Regs.ETSEL.bit.INTEN = <span class="number">0</span>; <span class="comment">// disable ePWM3 INT</span></span><br></pre></td></tr></table></figure>
<p>之后在SVPWM_Modified_1INT_0901.c文件中，将ePWM2和ePWM3相关的声明函数注释：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">interrupt <span class="keyword">void</span> <span class="title">epwm1_isr</span><span class="params">(<span class="keyword">void</span>)</span></span>;<span class="comment">//声明EPWM1中断服务程序</span></span><br><span class="line"><span class="comment">//interrupt void epwm2_isr(void);//声明EPWM2中断服务程序</span></span><br><span class="line"><span class="comment">//interrupt void epwm3_isr(void);//声明EPWM3中断服务程序</span></span><br></pre></td></tr></table></figure>
<p>将不需要的PIE中断与CPU中断的连接全部断开，允许ePWM1中断，即PIE组3向量的第一个中断INT3.1，INT3.2和INT3.3注释掉；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PieCtrlRegs.PIEIER3.bit.INTx1 = <span class="number">1</span>;<span class="comment">//允许PIE级中断INT3.1，即EPWM1中断</span></span><br><span class="line"><span class="comment">//   PieCtrlRegs.PIEIER3.bit.INTx2 = 1;//允许PIE级中断INT3.2，即EPWM2中断</span></span><br><span class="line"><span class="comment">//   PieCtrlRegs.PIEIER3.bit.INTx3 = 1;//允许PIE级中断INT3.3，即EPWM3中断</span></span><br></pre></td></tr></table></figure>
<p>将ePWM1的中断函数的地址映射到EPWM1_INT中断向量表，即中断向量的入口地址；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PieVectTable.EPWM1_INT = &amp;epwm1_isr;<span class="comment">//重新映射使用的中断向量，对应的地址P134页</span></span><br><span class="line"><span class="comment">//   PieVectTable.EPWM2_INT = &amp;epwm2_isr;</span></span><br><span class="line"><span class="comment">//   PieVectTable.EPWM3_INT = &amp;epwm3_isr;</span></span><br><span class="line">----------</span><br><span class="line"><span class="comment">// Group 3 PIE Peripheral Vectors:</span></span><br><span class="line">      PINT     EPWM1_INT;  <span class="comment">// EPWM-1</span></span><br><span class="line">      PINT     EPWM2_INT;  <span class="comment">// EPWM-2</span></span><br><span class="line">      PINT     EPWM3_INT;  <span class="comment">// EPWM-3</span></span><br><span class="line">      PINT     EPWM4_INT;  <span class="comment">// EPWM-4</span></span><br><span class="line">      PINT     EPWM5_INT;  <span class="comment">// EPWM-5</span></span><br><span class="line">      PINT     EPWM6_INT;  <span class="comment">// EPWM-6</span></span><br><span class="line">      PINT     rsvd3_7;</span><br><span class="line">      PINT     rsvd3_8;</span><br></pre></td></tr></table></figure>
<p>中断函数interrupt void epwm1_isr(void)的编写：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">interrupt <span class="keyword">void</span> <span class="title">epwm1_isr</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ua=m*Vdc/<span class="built_in">sqrt</span>(<span class="number">3</span>)*<span class="built_in">cos</span>(<span class="number">100</span>*PI*tctr);</span><br><span class="line">	ub=m*Vdc/<span class="built_in">sqrt</span>(<span class="number">3</span>)*<span class="built_in">cos</span>(<span class="number">100</span>*PI*tctr<span class="number">-2</span>*PI/<span class="number">3</span>);</span><br><span class="line">	uc=m*Vdc/<span class="built_in">sqrt</span>(<span class="number">3</span>)*<span class="built_in">cos</span>(<span class="number">100</span>*PI*tctr+<span class="number">2</span>*PI/<span class="number">3</span>);</span><br><span class="line">	cosne = (<span class="keyword">double</span>)<span class="number">2.0</span>/<span class="number">3</span>*(ua<span class="number">-0.5</span>*ub<span class="number">-0.5</span>*uc);</span><br><span class="line">	sinne = <span class="built_in">sqrt</span>(<span class="number">3</span>)/<span class="number">3</span>*(ub-uc);</span><br><span class="line">    <span class="comment">//将ua、ub、uc数组进行Clarke变换，m是调制比</span></span><br><span class="line">	u_alfa=cosne;</span><br><span class="line">	u_beta=sinne;</span><br><span class="line">    <span class="comment">//确定XYZ的值，详见自己的总结文档，这里的XYZ是标幺值</span></span><br><span class="line">    X1=u_beta;</span><br><span class="line">    Y1=<span class="number">0.867</span>*u_alfa<span class="number">-0.5</span>*u_beta;</span><br><span class="line">    Z1=<span class="number">-0.867</span>*u_alfa<span class="number">-0.5</span>*u_beta;</span><br><span class="line">    X = <span class="built_in">sqrt</span>(<span class="number">3</span>)*Ts/Vdc*X1;<span class="comment">//计算真正的矢量作量时间XYZ的值</span></span><br><span class="line">    Y = <span class="built_in">sqrt</span>(<span class="number">3</span>)*Ts/Vdc*Y1;</span><br><span class="line">    Z = <span class="built_in">sqrt</span>(<span class="number">3</span>)*Ts/Vdc*Z1;</span><br><span class="line">    <span class="comment">//用X、Y、Z可以判断扇区，sec=315462分别对应扇区123456</span></span><br><span class="line">    <span class="keyword">if</span>(X1&gt;<span class="number">0</span>) A=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> A=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(Y1&gt;<span class="number">0</span>) B=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> B=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(Z1&gt;<span class="number">0</span>) C=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> C=<span class="number">0</span>;</span><br><span class="line">    N=<span class="number">4</span>*C+<span class="number">2</span>*B+A;</span><br><span class="line">    <span class="comment">//将数字N转化成对应的扇区号</span></span><br><span class="line">    <span class="keyword">switch</span>(N)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: &#123;sec=<span class="number">2</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;sec=<span class="number">6</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: &#123;sec=<span class="number">1</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: &#123;sec=<span class="number">4</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: &#123;sec=<span class="number">3</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: &#123;sec=<span class="number">5</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据参考电压矢量所在的扇区确定标准矢量的作用时间</span></span><br><span class="line">    <span class="keyword">switch</span>(sec)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: &#123;t1=Y;  t2=X;  t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;t1=-Y; t2=-Z; t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: &#123;t1=X;  t2=Z;  t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: &#123;t1=-X; t2=-Y; t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: &#123;t1=Z;  t2=Y;  t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: &#123;t1=-Z; t2=-X; t0=Ts-t1-t2; <span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将T1、T2进行饱和处理</span></span><br><span class="line">    <span class="keyword">if</span>(t1+t2&gt;Ts)</span><br><span class="line">    &#123;</span><br><span class="line">    	t1=t1*Ts/(t1+t2);</span><br><span class="line">    	t2=t2*Ts/(t1+t2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义三个切换时刻Taon、Tbon、Tcon</span></span><br><span class="line">    Taon=t0/<span class="number">4</span>;</span><br><span class="line">    Tbon=t0/<span class="number">4</span>+t1/<span class="number">2</span>;</span><br><span class="line">    Tcon=t0/<span class="number">4</span>+t1/<span class="number">2</span>+t2/<span class="number">2</span>;</span><br><span class="line">    <span class="comment">//根据扇区给切换时刻Taon、Tbon、Tcon</span></span><br><span class="line">    <span class="keyword">switch</span>(sec)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: &#123;Ta=Taon; Tb=Tbon; Tc=Tcon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;Ta=Tbon; Tb=Taon; Tc=Tcon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: &#123;Ta=Tcon; Tb=Taon; Tc=Tbon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: &#123;Ta=Tcon; Tb=Tbon; Tc=Taon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: &#123;Ta=Tbon; Tb=Tcon; Tc=Taon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: &#123;Ta=Taon; Tb=Tcon; Tc=Tbon; <span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//给A、B、C的比较寄存器赋值</span></span><br><span class="line">    EPwm1Regs.CMPA.half.CMPA = Ta*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    EPwm1Regs.CMPB = Ta*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    EPwm2Regs.CMPA.half.CMPA = Tb*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    EPwm2Regs.CMPB = Tb*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    EPwm3Regs.CMPA.half.CMPA = Tc*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    EPwm3Regs.CMPB = Tc*EPwm1Regs.TBPRD/(Ts/<span class="number">2</span>);</span><br><span class="line">    tctr=(<span class="keyword">double</span>)(tctr+(<span class="keyword">double</span>)Ts);</span><br><span class="line">    k1++;</span><br><span class="line">	<span class="keyword">if</span>(tctr&gt;=<span class="number">0.02</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		tctr=<span class="number">0</span>;</span><br><span class="line">		k1=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//    Voltage1[k1]=EPwm1Regs.CMPA.half.CMPA ;//观察用</span></span><br><span class="line">  Voltage1[k1]=Ta;</span><br><span class="line">	EPwm1Regs.ETCLR.bit.INT = <span class="number">1</span>;             <span class="comment">//清除标志位</span></span><br><span class="line">	PieCtrlRegs.PIEACK.all = PIEACK_GROUP3;  <span class="comment">//清除应答位,中断结束后准备下一次中断响应。</span></span><br><span class="line">	EINT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将工程编译之后观察ePWM1、ePWM2、ePWM3模块的脉冲波形：</p>
<p><img data-src="https://tva1.sinaimg.cn/large/0084Tjdoly1gu4wnbyxh0j61400u04hu02.jpg" alt="image"> <img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gu4won3eltj31400u07o9.jpg" alt="image"> <img data-src="https://tvax4.sinaimg.cn/large/0084Tjdoly1gu4wrrfuulj61400u0kbb02.jpg" alt="image"></p>
<p>可以发现波形是正确的，10ms内有五个参考波，即50Hz，PWM的频率为12.8kHz，不知道为什么用之前的线显示的载波频率为25.6kHz，用Probe Comp测得的载波频率为12.8kHz，是与自己设定的是一致的。</p>
<p>那么接下来需要想的是如何去改变Ts和各个模块的TBPRD的值。</p>
<p>思路：在ePWM2中断中进行Ts和TBPRD值的修改，由于ePWM1的中断执行完之后，紧接着执行ePMW2的中断，因为ePWM1、ePWM2初始化设置的都是在TBCTR=0的时候进入中断，所以在ePWM1中断执行完之后，那么比较寄存器的值已经有了，tctr加上上一个Ts的值，进入下一个时刻，准备好下一个的比较，之后进入ePWM2中断，我设置k2进行计数，用一个if：当k2是奇数的时候，改变一个Ts，更新TBPRD的值；当k2是偶数的时候，改变一个Ts，更新TBPRD的值；之后k2++；这样ePWM2中断执行完之后，就更新了新的Ts和TBPRD，正好和新的tctr的时刻进行比较…</p>
<p>但是发现中断进了两次就跑飞了…，如果将其他的代码注释掉k2是在一直加的。</p>
<h3 id="星期四"><a href="#星期四" class="headerlink" title="星期四"></a>星期四</h3><p>将中断服务子程序的代码全部注释，保留以下代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.CMPA.half.CMPA = <span class="number">0.1</span>*EPwm1Regs.TBPRD;</span><br><span class="line">EPwm1Regs.CMPB = <span class="number">0.1</span>*EPwm1Regs.TBPRD;</span><br><span class="line">EPwm2Regs.CMPA.half.CMPA = <span class="number">0.5</span>*EPwm1Regs.TBPRD;</span><br><span class="line">EPwm2Regs.CMPB = <span class="number">0.5</span>*EPwm1Regs.TBPRD;</span><br><span class="line">EPwm3Regs.CMPA.half.CMPA = <span class="number">0.9</span>*EPwm1Regs.TBPRD;</span><br><span class="line">EPwm3Regs.CMPB = <span class="number">0.9</span>*EPwm1Regs.TBPRD;</span><br></pre></td></tr></table></figure>
<p>以ePWM1模块的波形为例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.CMPA.half.CMPA = <span class="number">0.1</span>*EPwm1Regs.TBPRD;</span><br><span class="line">EPwm1Regs.CMPB = <span class="number">0.1</span>*EPwm1Regs.TBPRD;</span><br></pre></td></tr></table></figure>
<p>理论分析输出的ePWM1xA的波形和ePWM1xB的波形为，即ePWM1xA输出脉冲的占空比为0.9，ePWM1xB输出脉冲的占空比为0.1：</p>
<p><img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gu4wuyqzwzj616s0rwnol02.jpg" alt="image"></p>
<p><img data-src="https://tvax1.sinaimg.cn/large/0084Tjdoly1gu4wv6dbzrj60uo0lhgul02.jpg" alt="image"></p>
<p>在设置完动作模块之后，我们接着需要设置死区模块：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/Set the dead P213、<span class="number">214</span>页</span><br><span class="line">EPwm1Regs.DBCTL.all=<span class="number">0x0</span>;</span><br><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x3</span>; <span class="comment">//ePWMxB作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x3</span>; <span class="comment">//使能双边沿延时</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x1</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB翻转；</span></span><br><span class="line">EPwm1Regs.DBRED = dead_time;<span class="comment">//设定上升沿死区时间</span></span><br><span class="line">EPwm1Regs.DBFED = dead_time;<span class="comment">//设定下降沿死区时间</span></span><br></pre></td></tr></table></figure>
<p>但是死区模块的设置有个问题就是有些模式设置之后，ePWM1xA或者ePWM1xB的波形可能会发生翻转。于是将所有可能存在的设置模式进行了汇总与整理：</p>
<p>1、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxA作为双边沿延时输入源</strong>，IN_MODE位为00，输出控制为<strong>ePWMxA和ePWMxB不经过死区模块</strong>，即OUT_MODE位为00；<strong>此时ePWMxA和ePWMxB的输出波形正确</strong>，不需要进行翻转，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA和ePWMxB不经过死区模块</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB不翻转</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x0，OUT_MODE = 0x0，POLSEL =0x0</p>
<p>2、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxA作为双边沿延时输入源</strong>，IN_MODE位为00，输出控制为<strong>禁止上升沿延时，使能下降沿延时</strong>，即OUT_MODE位为01；<strong>ePWMxB的输出波形默认会发生翻转，TI默认的！</strong>太阴间了！如果要看正确的ePWMxB的波形，需要将极性选择为ePWMxA不翻转，ePWMxB翻转，即POLSEL位为0x2；这样输出的ePWMxA和ePWMxB的波形就是对的！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x1</span>; <span class="comment">//**禁止上升沿延时，使能下降沿延时**</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x2</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB翻转</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x0，OUT_MODE = 0x1，POLSEL =0x2</p>
<p>3、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxA作为双边沿延时输入源</strong>，IN_MODE位为00，输出控制为<strong>禁止下降沿延时，使能上升沿延时</strong>，即OUT_MODE位为10；<strong>此时ePWMxA和ePWMxB的输出波形正确</strong>，不需要进行翻转，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x2</span>; <span class="comment">//禁止下降沿延时，**使能上升沿延时**</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB不翻转</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x0，OUT_MODE = 0x2，POLSEL =0x0</p>
<p>4、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxA作为双边沿延时输入源</strong>，IN_MODE位为00，输出控制为<strong>使能双边沿延时</strong>，即OUT_MODE位为11；<strong>ePWMxB的输出波形默认会发生翻转，TI默认的！</strong>太阴间了！如果要看正确的ePWMxB的波形，需要将极性选择为ePWMxA不翻转，ePWMxB翻转，即POLSEL位为0x2；这样输出的ePWMxA和ePWMxB的波形就是对的！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x3</span>; <span class="comment">//使能双边沿延时</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x2</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x0，OUT_MODE = 0x3，POLSEL =0x2</p>
<p>5、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxB作为上升沿延时输入源，ePWMxA是下降沿输入源</strong>，IN_MODE=01；输出控制为<strong>ePWMxA和ePWMxB不经过死区模块</strong>，OUT_MODE位=00；<strong>此时ePWMxA和ePWMxB的输出波形正确</strong>，不需要进行翻转，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x1</span>; <span class="comment">//ePWMxB作为上升沿延时输入源，ePWMxA作为下降沿延时输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA和ePWMxB不经过死区模块</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA翻转，ePWMxB不翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x1，OUT_MODE = 0x0，POLSEL =0x0</p>
<p>6、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxA是下降沿延时输入源</strong>，ePWMxB作为上升沿输入源，IN_MODE=01；输出控制为<strong>禁止上升沿延时，使能下降沿延时</strong>，OUT_MODE位=01；<strong>此时ePWMxB的输出波形会发生翻转，TI默认的；</strong>那么观察正确的ePWMxA、ePWMxB波形就需要设置ePWMxA不翻转，ePWMxB翻转，即POSEL位为10；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x1</span>; <span class="comment">//**ePWMxA是下降沿延时输入源**，ePWMxB作为上升沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x1</span>; <span class="comment">//禁止上升沿延时，**使能下降沿延时**</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x2</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x1，OUT_MODE = 0x1，POLSEL =0x2</p>
<p>7、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxB作为上升沿延时输入源，ePWMxA是下降沿输入源</strong>，IN_MODE=01；输出控制为<strong>禁止下降沿延时，使能上升沿延时</strong>，OUT_MODE位=10；<strong>此时ePWMxA的输出波形会发生翻转，TI默认的</strong>；那么观察正确的ePWMxA、ePWMxB波形就需要设置ePWMxA翻转，ePWMxB不翻转，即POSEL位为01；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x1</span>; <span class="comment">//ePWMxB作为上升沿延时输入源，ePWMxA作为下降沿延时输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x2</span>; <span class="comment">//禁止下降沿延时，使能上升沿延时</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x1</span>;<span class="comment">//极性选择控制，ePWMxA翻转，ePWMxB不翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x1，OUT_MODE = 0x2，POLSEL =0x1</p>
<p>8、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxB作为上升沿延时输入源，ePWMxA是下降沿输入源</strong>，IN_MODE=01；输出控制为<strong>使能双边沿延时</strong>，OUT_MODE位=11；<strong>此时ePWMxA和ePWMxB的输出波形都会发生翻转，TI默认的</strong>；那么观察正确的ePWMxA、ePWMxB波形，就需要设置ePWMxA翻转，ePWMxB翻转，即POSEL位为11；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x1</span>; <span class="comment">//ePWMxB作为上升沿延时输入源，ePWMxA作为下降沿延时输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x3</span>; <span class="comment">//**使能双边沿延时**</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x3</span>;<span class="comment">//极性选择控制，ePWMxA翻转，ePWMxB翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x1，OUT_MODE = 0x3，POLSEL =0x3</p>
<p>9、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxA作为上升沿延时输入源，ePWMxB是下降沿输入源</strong>，IN_MODE位=10；输出控制为<strong>ePWMxA和ePWMxB不经过死区模块</strong>，OUT_MODE位=00；<strong>此时ePWMxA、ePWMxB的输出波形就不会发生翻转</strong>；那么观察正确的ePWMxA、ePWMxB波形就不需要设置POSEL位，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x2</span>; <span class="comment">//ePWMxA作为上升沿延时输入源，ePWMxB作为下降沿延时输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA和ePWMxB不经过死区模块</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA翻转，ePWMxB不翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x2，OUT_MODE = 0x0，POLSEL =0x0</p>
<p>10、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxB是下降沿延时输入源</strong>，ePWMxA作为上升沿输入源，IN_MODE=10；输出控制为<strong>禁止上升沿延时，使能下降沿延时</strong>，OUT_MODE位=01；<strong>此时ePWMxA和ePWMxB的输出波形正确</strong>，不需要进行翻转，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x2</span>; <span class="comment">//**ePWMxB是下降沿延时输入源**，ePWMxA作为上升沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x1</span>; <span class="comment">//禁止上升沿延时，使能下降沿延时</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x2，OUT_MODE = 0x1，POLSEL =0x0</p>
<p>11、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxA作为上升沿延时输入源，ePWMxB是下降沿输入源</strong>，IN_MODE位=10；输出控制为<strong>禁止下降沿延时，使能上升沿延时</strong>，OUT_MODE位=10；<strong>此时ePWMxA、ePWMxB的输出波形就不会发生翻转</strong>；那么观察正确的ePWMxA、ePWMxB波形就不需要设置POSEL位，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x2</span>; <span class="comment">//ePWMxA作为上升沿延时输入源，ePWMxB作为下降沿延时输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x2</span>; <span class="comment">//禁止下降沿延时，使能上升沿延时</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB不翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x2，OUT_MODE = 0x2，POLSEL =0x0</p>
<p>12、如果<strong>死区使用单边沿延时</strong>，选择<strong>ePWMxA作为上升沿延时输入源，ePWMxB是下降沿输入源</strong>，IN_MODE位=10；输出控制为<strong>使能双边沿延时</strong>，OUT_MODE位=11；<strong>此时ePWMxA、ePWMxB的输出波形就不会发生翻转</strong>；那么观察正确的ePWMxA、ePWMxB波形就不需要设置POSEL位，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x2</span>; <span class="comment">//ePWMxA作为上升沿延时输入源，ePWMxB作为下降沿延时输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x3</span>; <span class="comment">//使能双边沿延时</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB不翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x2，OUT_MODE = 0x3，POLSEL =0x0</p>
<p>13、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxB作为双边沿延时输入源</strong>，IN_MODE位为11，输出控制为ePWMxA和ePWMxB不经过死区模块，即OUT_MODE位为00；<strong>此时ePWMxA和ePWMxB的输出波形正确</strong>，不需要进行翻转，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x3</span>; <span class="comment">//ePWMxB作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x0</span>; <span class="comment">//ePWMxA和ePWMxB不经过死区模块</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB不翻转</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x3，OUT_MODE = 0x0，POLSEL =0x0</p>
<p>14、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxB作为双边沿延时输入源</strong>，IN_MODE位为11，输出控制为<strong>禁止上升沿延时，使能下降沿延时</strong>，即OUT_MODE位为01；<strong>此时ePWMxA和ePWMxB的输出波形正确</strong>，不需要进行翻转，即POSEL位为00；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x3</span>; <span class="comment">//ePWMxB作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x1</span>; <span class="comment">//**禁止上升沿延时，使能下降沿延时**</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x0</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB不翻转</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x3，OUT_MODE = 0x1，POLSEL =0x0</p>
<p>15、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxB作为双边沿延时输入源</strong>，IN_MODE位为11，输出控制为<strong>禁止下降沿延时，使能上升沿延时</strong>，即OUT_MODE位为10；<strong>此时ePWMxA的输出波形发生了翻转</strong>，如果要看正确的ePWMxA的波形，需要将极性选择为ePWMxA翻转，ePWMxB不翻转，即POLSEL位为0x1；这样输出的ePWMxA和ePWMxB的波形就是对的！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x3</span>; <span class="comment">//ePWMxB作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x2</span>; <span class="comment">//**禁止下降沿延时，使能上升沿延时**</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x1</span>;<span class="comment">//极性选择控制，ePWMxA翻转，ePWMxB不翻转</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x3，OUT_MODE = 0x2，POLSEL =0x1</p>
<p>16、如果<strong>死区使用双边沿延时</strong>，选择<strong>ePWMxB作为双边沿延时输入源</strong>，IN_MODE位为11，输出控制为<strong>使能双边沿延时</strong>，即OUT_MODE位为11；<strong>ePWMxA的输出波形默认会发生翻转，TI默认的！</strong>太阴间了！如果要看正确的ePWMxA的波形，需要将极性选择为ePWMxA翻转，ePWMxB不翻转，即POLSEL位为0x1；这样输出的ePWMxA和ePWMxB的波形就是对的！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.DBCTL.bit.IN_MODE = <span class="number">0x3</span>; <span class="comment">//ePWMxB作为双边沿输入源</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.OUT_MODE = <span class="number">0x3</span>; <span class="comment">//使能双边沿延时</span></span><br><span class="line">EPwm1Regs.DBCTL.bit.POLSEL =<span class="number">0x1</span>;<span class="comment">//极性选择控制，ePWMxA不翻转，ePWMxB翻转；</span></span><br></pre></td></tr></table></figure>
<p>IN_MODE = 0x3，OUT_MODE = 0x3，POLSEL =0x1</p>
<p>以后只要用到死区，选择需要的死区模式，并将对应的代码进行设置，则输出的ePWMxA和ePWMxB的波形就是正确的。不会出现哪个模块波形翻转的问题。之前查看波形发现波形不对，坑了我一整天！最后才发现这个问题😭，气得我把所有的情况全部总结出来了！</p>
<h3 id="星期五"><a href="#星期五" class="headerlink" title="星期五"></a>星期五</h3><p>将死区模式设置总结成一个《关于TMS320F28335的ePWM模块的死区模式设置》文档，以便之后进行查看。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.TBPRD=<span class="number">5000</span>;</span><br><span class="line">EPwm2Regs.TBPRD=<span class="number">3000</span>;</span><br><span class="line">EPwm3Regs.TBPRD=<span class="number">2500</span>;</span><br><span class="line">EPwm1Regs.CMPA.half.CMPA = <span class="number">2000</span>;</span><br><span class="line">EPwm1Regs.CMPB = <span class="number">2000</span>;</span><br><span class="line">EPwm2Regs.CMPA.half.CMPA = <span class="number">2000</span>;</span><br><span class="line">EPwm2Regs.CMPB = <span class="number">2000</span>;</span><br><span class="line">EPwm3Regs.CMPA.half.CMPA = <span class="number">2000</span>;</span><br><span class="line">EPwm3Regs.CMPB = <span class="number">2000</span>;</span><br></pre></td></tr></table></figure>
<p>将ePWM1、2、3模块的TBPRD的值进行了修改，改成一个定值，然后让三个比较寄存器的值设置是一样的，这样编译之后观察ePWM1、ePWM2、ePWM3模块的脉冲波形的占空比就可知道TBPRD的值是否发生改变。编译之后发现TBPRD的值是可以改变的，所以可以实现对TBPRD进行赋值！</p>
<p>当Ts的频率太高时，进入中断的事件太短还是DSP的算力不足，输出的参考波的频率不正确；最大的Ts频率设置为22000Hz左右。</p>
<p>当设置的频率较低时候，k2在变化的时候，输出的波形脉冲每隔一个周期占空比就会发生一次变化。与编程想要实现的要求一致。刘老师说再想想还能不能减少程序的运算量。因为载波频率高，说明时基寄存器一个周期特别小，则可能中断还没结束就准备进入下一个中断了。会把程序抛弃重新进入中断执行程序。</p>
<h3 id="星期六"><a href="#星期六" class="headerlink" title="星期六"></a>星期六</h3><p>将暑假的一些总结进行了汇总与整理，刘老师说叫我将所有的内容整理成文档，方便以后查看，并准备将PWM的整个编程的流程和刘老师进行讲解。于是首先将等幅值Clarke变换和等功率Clarke变换整理成《关于等幅值Clarke变换和等功率Clarke变换的理解》文档，将空间矢量的概念和SVPWM的工作原理整理成《关于空间矢量的概念和SVPWM的工作原理》文档。将CCS烧写的问题整理成功《关于CCS烧写FLASH和烧写RAM的一些理解，如何修改CMD文件》文档，将Tek示波器如何导出波形整理成《关于Tek示波器导出波形的方法》文档，以及最坑人的死区模块设置问题整理成《关于TMS320F28335的ePWM模块的死区模式设置》文档：</p>
<p><img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gu4x8ji6osj60jr080td202.jpg" alt="image"></p>
<h2 id="一些感悟🧠"><a href="#一些感悟🧠" class="headerlink" title="一些感悟🧠"></a>一些感悟🧠</h2><p>大学取得的所有成绩一切清零，研究生大家又都是同一个起跑线，当然大学之后自己的能力还是在的，希望研究生能让自己的其他弱项得到提升。</p>
<p>发现睡一个好觉真的能改变心情，一般自己晚上睡得好，第二天状态就还行，每天都要运动，自己是那种不运动就很难受的😂，运动之后感觉整个人都很舒服！</p>
<p>研究生四人寝，新室友有一个是行政保研的学长，还有一个二战的，另外一个是同一届的本科同学，研究生发现很多人都不是同龄人了……甚至还有个三战的学长。</p>
<p>研究生新的室友人都还不错，就是有一个室友会打呼噜🤦‍，不过比我另一个同学的室友好多了，他的室友有一个每天六点半起来，还有一个睡觉打呼噜，我的妈耶…是我真的受不了😓，还好我睡觉不打呼噜，不然也会被“嫌弃”</p>
<h2 id="哲思学意📚"><a href="#哲思学意📚" class="headerlink" title="哲思学意📚"></a>哲思学意📚</h2><p>当你老了，回顾一生，就会发觉：什么时候出国读书、什么时候决定做第一份职业、何时选定了对象而恋爱、什么时候结婚，其实都是命运的巨变。只是当时站在三岔路口，眼见风云千樯，你作出抉择的那一日，在日记上，相当的沉闷和平凡，当时还以为是生命中普通的一天。—— 陶杰《杀鹌鹑的少女》</p>
<p>每个人都会有一段异常艰难的时光，生活的压力，工作的失意，学业的压力，爱的惶惶不可终日，挺过来的，人生就会豁然开朗，挺不过来的，时间也会教你，怎么与它们握手言和，所以不必害怕的。——杨绛</p>
<p>所谓长大，就是你知道那是什么事；所谓成熟，就是你知道后故意说不知道。——李敖</p>
<p>没有人愿意一直向下兼容，也没有人甘于一直向上仰望，真正靠谱又长久的关系，是我们虽然联系得不多，却可以始终与对方保持同频。默契相知的关系，不需要寒暄。</p>
<p>成熟不只是看懂事情，更在于看透人性，真正的成熟，源于对人性的深刻理解，认识到社会的复杂性，认识到人性的复杂性，以坦然的姿态融入社会，不对人性有过多幻想和期待，也不对人性有过于恶劣的解读。</p>
<h2 id="休息娱乐😓"><a href="#休息娱乐😓" class="headerlink" title="休息娱乐😓"></a>休息娱乐😓</h2><p>最近看到一个非常棒的纪录片《荒野间谍》！</p>
<iframe src="//player.bilibili.com/player.html?aid=95576315&bvid=BV1yE411L7mS&cid=163164170&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>荒野间谍（英語：Spy in the Wild）是英国一部自然纪录片系列，由BBC自然历史部、约翰·唐纳制片公司、PBS共同制作。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://ncepuee.github.io/2021/08/29/20210823-0829/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="菜菜的黄">
      <meta itemprop="description" content="记录科研生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="School boy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/29/20210823-0829/" class="post-title-link" itemprop="url">20210822-0829周报</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-29 08:00:00" itemprop="dateCreated datePublished" datetime="2021-08-29T08:00:00+08:00">2021-08-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="每周音乐🎵"><a href="#每周音乐🎵" class="headerlink" title="每周音乐🎵"></a>每周音乐🎵</h2><p>马上就要开学了，开学意味着研究生生涯的正式开始，暑假在学校被封一个暑假，还算充实吧…</p>
<iframe frameborder="0" height="80" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;"  src="//music.163.com/outchain/player?type=2&id=1299550532&auto=0&height=66"></iframe>

<h2 id="运动歌单🏃‍"><a href="#运动歌单🏃‍" class="headerlink" title="运动歌单🏃‍"></a>运动歌单🏃‍</h2><p>研究生重新换了一个运动软件「小米运动」，主要是一直用小米手环，测了大学三年的睡眠数据，想着以后就用小米运动连接手环跑步的时候用来提醒自己跑了多少公里，这样就不用看手机了，个人觉得不用买智能手表，我觉得手环已经完成能够记录日常生活了。</p>
<p>适合跑步运动的歌单（Music）</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="450" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/playlist/running-fitness-sports/pl.u-Ldbqel5u27kmjlm"></iframe>

<h2 id="学习进展✍"><a href="#学习进展✍" class="headerlink" title="学习进展✍"></a>学习进展✍</h2><h3 id="星期一"><a href="#星期一" class="headerlink" title="星期一"></a>星期一</h3><p>由于自己的编的代码，但是代码能编译成功，但是不知道为什么将代码烧到硬件中，出来的波形不是很对，反复检查代码也没发现哪里出错了，于是只能找刘老师帮我调试下，和刘老师调试了一个下午都还没调试出来，但是对CCS软件有更深刻的了解，了解了下如何打断点，刘老师说我扇区一直不对，我信了老师的话，但是运动完之后回来，我发现Expression其实是可以采样进行实时观察变量的变化：</p>
<p><img data-src="https://tvax1.sinaimg.cn/large/0084Tjdoly1gtsrcxuqijj61hc0u07wh02.jpg" alt="实时观察变量"></p>
<p>和刘老师反馈他理解错了，我的扇区是在时刻变化的，并不是只在两个扇区内跳……因为Expression变量是时刻变化的，sec扇区是123456都有跳变，说明扇区判断是对的。</p>
<p><img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gtss4y7bv3j60t70ekn8j02.jpg" alt="Expression的使用"></p>
<blockquote>
<p>这里说明下怎么使用Expression的功能，当我们将程序运行在板子之后，我们就可以在Expression中观察自己设置的变量的数值变化，点击刷新的botton就可以实现实时刷新，点击▽的Continuous Refresh Interval，出现如下的弹窗，之后设置值最小为100ms，也就是10Hz的刷新率，最大只能这么大了！这样就能实时观察变量数据的变化。<br><img data-src="https://tvax4.sinaimg.cn/large/0084Tjdoly1gtssagqxstj60ss0g5k0h02.jpg"></p>
</blockquote>
<h3 id="星期二"><a href="#星期二" class="headerlink" title="星期二"></a>星期二</h3><h4 id="ROM、FLASH、RAM的区别"><a href="#ROM、FLASH、RAM的区别" class="headerlink" title="ROM、FLASH、RAM的区别"></a>ROM、FLASH、RAM的区别</h4><p>由于Flash烧写次数有限制，刘老师问我板子如何进行烧写，我开始以为是直接烧写Flash，但是随着进一步的查询，了解了ROM、FLASH、RAM的区别。</p>
<p>我觉得还是有必要说一下这个，当个常识了解下！</p>
<p>RAM和ROM的区别，或者说ROM和RAM的区别是什么呢？ROM和RAM都是一种存储技术，只是两者原理不同，RAM为随机存储，掉电不会保存数据，而ROM可以在掉电的情况下，依然保存原有的数据。ROM和RAM指的都是半导体存储器。本来的含义是：ROM是Read Only Memory的意思，也就是说这种存储器只能读，不能写。而RAM是Random Access Memory的缩写。这个词的由来是因为早期的计算机曾经使用磁鼓作为内存，而磁鼓和磁带都是典型的顺序读写设备。RAM则可以随机读写。</p>
<p>内存RAM是指随机存取存储器（random access memory，RAM）又称作“随机存储器”，是与CPU直接交换数据的内部存储器，也叫主存(内存)。 它可以随时读写，而且速度很快，通常作为操作系统或其他正在运行中的程序的短时间临时数据存储媒介。</p>
<p>通俗的说，比如在电脑中，大家都知道有内存和硬盘之说，其实内存就是一种RAM技术，而ROM则类似于硬盘技术，两者都是存储器，只是RAM的速度要远远高于ROM的速度，在电脑日常操作中，很多程序都将临时运行的程序命令，存放在内存中，但一旦关机或者停电，内存里原本临时存储的程序信息将全部被清空，也就是内存只能临时存储东西，不能长久保存，而ROM则可以存储，即使掉电后也可以找到之前存储的文件，这也就是硬盘了。</p>
<p>在手机中，RAM是指手机内存，属于手机内部存储器，属于随机存储，速度高于ROM，对于手机配置性能起着重要的决定性，另外掉电后，数据被清空，比如手机运行着QQ与其它软件，重启手机后，软件就没有处于登录状态。</p>
<p>而ROM则属于外部存储，比如我们经常可以购买SD卡放入手机里面，则就是手机ROM，手机ROM就是我们通常说的存储卡，也可以简单的理解成手机硬盘吧。用来存储手机系统文件、图片、电影等等，不会随着掉电而丢失数据，ROM越大存储的数据就越多。</p>
<p>RAM可以反复擦写，内存的寿命和老化有关，而和读写次数无关。</p>
<p>这里举例DRAM（Dynamic Random Access Memory）是靠电容来存储电荷，用电荷存在与否来表示“0”“1”，这个过程可以说没有电子元件物理状态的改变，只是电荷是不是在电容中而已。</p>
<p>Flash 存储器（FLASH EEPROM）又称闪存，快闪。它是EEPROM的一种。它结合了ROM和RAM的长处。不仅具备电子可擦除可编辑（EEPROM）的性能，还不会断电丢失数据同时可以快速读取数据。它于EEPROM的最大区别是，FLASH按扇区（block）操作，而EEPROM按照字节操作。FLASH的电路结构较简单，同样容量占芯片面积较小，成本自然比EEPROM低，因此适合用于做程序存储器。</p>
<p>对于RAM, ROM以及FLASH的区别，简单地说，在计算机中，RAM 、ROM都是数据存储器。RAM 是随机存取存储器，它的特点是易挥发性，即掉电失忆。ROM 通常指固化存储器(一次写入，反复读取)，它的特点与RAM 相反。ROM又分一次性固化、光擦除和电擦除重写两种类型。</p>
<p>在应用中，常规上ROM是用来存储固化程序的，RAM是用来存放数据的。由于FLASH ROM比普通的ROM读写速度快，擦写方便，一般用来存储用户程序和需要永久保存的数据。譬如说，现在家用的电子式电度表，它的内核是一款单片机，该单片机的程序就是存放在ROM里的。电度表在工作过程中，是要运算数据的，要采集电压和电流，并根据电压和电流计算出电度来。电压和电流时一个适时的数据，用户不关心，它只是用来计算电度用，计算完后该次采集的数据就用完了，然后再采集下一次，因此这些值就没必要永久存储，就把它放在RAM里边。然而计算完的电度，是需要永久保存的，单片机会定时或者在停电的瞬间将电度数存入到FLASH里。</p>
<h4 id="烧写FLASH和烧写RAM"><a href="#烧写FLASH和烧写RAM" class="headerlink" title="烧写FLASH和烧写RAM"></a>烧写FLASH和烧写RAM</h4><p>所以知道了RAM和Flash的区别后，CCS把.out文件烧写到板子上，有两种方式，一种是烧写到RAM，一种是烧写到Flash，但是不知道怎样是烧写到RAM、怎样是烧写到Flash，经过查询找到两者的区别：</p>
<p><img data-src="https://tvax1.sinaimg.cn/large/0084Tjdoly1gtsrrha7p2j60v00iuaqt02.jpg" alt="烧写RAM和烧写Flash的区别1"></p>
<p><img data-src="https://tvax1.sinaimg.cn/large/0084Tjdoly1gtsru11rmwj60rs0hjwni02.jpg" alt="烧写RAM和烧写Flash的区别2"></p>
<p>所以应该是使用的CMD文件不一样，什么是CMD文件呢？</p>
<p>CMD文件，又称链接命令文件，主要作用是分配rom和ram空间，它告诉链接程序怎样计算地址和分配空间。例如，应该把程序放在哪块地址内，把数据放在哪块地址内以及把程序中定义的某些变量放在哪块地址内。</p>
<p>当使用F28335进行烧写.out文件时，如果使用的是28335_RAM_lnk.cmd文件，那么就是把.out文件烧写到RAM，用RAM可以一直烧写debug，但是最后固化程序之后再烧写到flash，就需要选择F28335.cmd文件，这样最后烧写就是直接烧写到flash，在CCS下找到该文件，右击28335_RAM_Ink.cmd，将Exclude from Build勾选，在F28335.cmd中取消Exclude from Build勾选，就可以将程序烧写到Flash中。反之，烧写到RAM 中。</p>
<h4 id="程序过长如何修改CMD文件"><a href="#程序过长如何修改CMD文件" class="headerlink" title="程序过长如何修改CMD文件"></a>程序过长如何修改CMD文件</h4><p>如果.c文件的程序编写过长，就可能会超出存储器的范围，出现这样的报错：error #10099-D: program will not fit into available memory.</p>
<p>那么这个时候就需要修改CMD文件，打开CMD文件，找到.text：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#endif    </span><br><span class="line">   </span><br><span class="line">   .text            : &gt; RAML1,     PAGE &#x3D; 0</span><br><span class="line">   .cinit           : &gt; RAML0,     PAGE &#x3D; 0</span><br><span class="line">   .pinit           : &gt; RAML0,     PAGE &#x3D; 0</span><br><span class="line">   .switch          : &gt; RAML0,     PAGE &#x3D; 0</span><br><span class="line"></span><br><span class="line">   .stack           : &gt; RAMM1,     PAGE &#x3D; 1</span><br><span class="line">   .ebss            : &gt; RAML4,     PAGE &#x3D; 1</span><br><span class="line">   .econst          : &gt; RAML5,     PAGE &#x3D; 1</span><br><span class="line">   .esysmem         : &gt; RAMM1,     PAGE &#x3D; 1</span><br><span class="line"></span><br><span class="line">   IQmath           : &gt; RAML1,     PAGE &#x3D; 0</span><br><span class="line">   IQmathTables     : &gt; IQTABLES,  PAGE &#x3D; 0, TYPE &#x3D; NOLOAD</span><br></pre></td></tr></table></figure>
<p>.text对应的段，也就是我们编写的程序是在RAML1，PAGE =0的位置，我们找到PAGE 0的RAML1位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MEMORY</span><br><span class="line">&#123;</span><br><span class="line">PAGE 0 :</span><br><span class="line">   &#x2F;* BEGIN is used for the &quot;boot to SARAM&quot; bootloader mode      *&#x2F;</span><br><span class="line"></span><br><span class="line">   BEGIN      : origin &#x3D; 0x000000, length &#x3D; 0x000002     &#x2F;* Boot to M0 will go here                      *&#x2F;</span><br><span class="line">   RAMM0      : origin &#x3D; 0x000050, length &#x3D; 0x0003B0</span><br><span class="line">   RAML0      : origin &#x3D; 0x008000, length &#x3D; 0x001000</span><br><span class="line">   RAML1      : origin &#x3D; 0x009000, length &#x3D; 0x002000</span><br><span class="line">&#x2F;&#x2F;   RAML2      : origin &#x3D; 0x00A000, length &#x3D; 0x001000</span><br><span class="line">   RAML3      : origin &#x3D; 0x00B000, length &#x3D; 0x001000</span><br><span class="line">   ZONE7A     : origin &#x3D; 0x200000, length &#x3D; 0x00FC00    &#x2F;* XINTF zone 7 - program space *&#x2F;</span><br><span class="line">   CSM_RSVD   : origin &#x3D; 0x33FF80, length &#x3D; 0x000076     &#x2F;* Part of FLASHA.  Program with all 0x0000 when CSM is in use. *&#x2F;</span><br><span class="line">   CSM_PWL    : origin &#x3D; 0x33FFF8, length &#x3D; 0x000008     &#x2F;* Part of FLASHA.  CSM password locations in FLASHA            *&#x2F;</span><br><span class="line">   ADC_CAL    : origin &#x3D; 0x380080, length &#x3D; 0x000009</span><br><span class="line">   RESET      : origin &#x3D; 0x3FFFC0, length &#x3D; 0x000002</span><br><span class="line">   IQTABLES   : origin &#x3D; 0x3FE000, length &#x3D; 0x000b50</span><br><span class="line">   IQTABLES2  : origin &#x3D; 0x3FEB50, length &#x3D; 0x00008c</span><br><span class="line">   FPUTABLES  : origin &#x3D; 0x3FEBDC, length &#x3D; 0x0006A0</span><br><span class="line">   BOOTROM    : origin &#x3D; 0x3FF27C, length &#x3D; 0x000D44</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现PAGE 0 对应的RAML1的位置在0x009000，长度是0x001000，如果需要将此位置变大，则可以将PAGE 0 下的RAML2的行代码注释，把RAML1的长度改成length = 0x002000。这样就能实现编译。</p>
<h4 id="如何防止烧写过程中加密FLASH"><a href="#如何防止烧写过程中加密FLASH" class="headerlink" title="如何防止烧写过程中加密FLASH"></a>如何防止烧写过程中加密FLASH</h4><p>编译完之后，我们先不要急着烧写到板子上，点开工程的DEBUG文件夹下的.map文件</p>
<p><img data-src="https://tva4.sinaimg.cn/large/0084Tjdoly1gtst1bbtf1j60uy0gmdwr02.jpg"></p>
<p>需要检查的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PAGE 0:</span><br><span class="line">&#x2F;&#x2F;只要这两行代码是这个就说明修改的CMD文件没有把FLASH加密可以放心地进行烧写 </span><br><span class="line">  CSM_RSVD              0033ff80   00000076  00000000  00000076  RWIX</span><br><span class="line">  CSM_PWL               0033fff8   00000008  00000000  00000008  RWIX</span><br></pre></td></tr></table></figure>
<p>只要这两行代码是上面一模一样正确的，就说明修改的CMD文件没有把FLASH加密可以放心地进行烧写！</p>
<h4 id="学习CCS的Graph的使用"><a href="#学习CCS的Graph的使用" class="headerlink" title="学习CCS的Graph的使用"></a>学习CCS的Graph的使用</h4><p>刘老师说CCS软件是可以用Graph看波形的，于是在CSDN找到了用Graph的教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/HJ199404182515/article/details/60467027">关于CCS软件的Graph功能使用详解</a></p>
<p>在程序烧写到28335的RAM之后，点击运行▷，这样在CCS Debug界面点击Tools下的Graph的Single Time，如下图所示：</p>
<p><img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gtssfum8t6j61hc0gph4102.jpg"></p>
<p>之后会弹出如下的窗口，如下图所示：</p>
<p><img data-src="https://tva4.sinaimg.cn/large/0084Tjdoly1gtsslaf0jvj60ce0gmjvv02.jpg"></p>
<p>Acquisition Buffer Size：表示通过仿真器从DSP的内存中读取的数据的大小，由于程序里用于存储信号的数组大小是256，这里我们设置成256，当然也可以设置成更小的值，这样就只能看到信号的部分图像。</p>
<p>Dsp Data Type：表示你的数据是什么类型的，这里选择32 bit floating point，根据自己需要看的变量的波形，选择定义变量的数据类型。</p>
<p>Index Increment：索引增量，表示每个数据点序号的相差值，这里我们是逐点显示的，因此默认设置为1，如果想要每隔一个点显示一个那么你就应该设置成2。</p>
<p>Q_Value：Q值，一般这不常用，默认就行。</p>
<p>Sampling Rate Hz：以Hz为单位的采样率，我设置为10000不知道为什么要这样设置：<a target="_blank" rel="noopener" href="https://bbs.elecfans.com/m/jishu_1597845_1_1.html">这是Google的教程</a></p>
<p>Start Address：开始地址，表示你要显示的数组的首地址，我们现在想要看的是数组ua因此，设置成ua。</p>
<p>Auto Scale：自动调整显示比例使其适应整个显示窗口。  这里我们开启。</p>
<p>Axis Display ：显示坐标轴，这里我们开启。</p>
<p>Data Plot Style：数据绘制类型，有Line和Bar两种，这里我们选择Line。</p>
<p>Display Data Size：显示数据大小，表示要将多少个点的数据进行显示，注意这个值一定要小于等于Acquisition Buffer Size，这里我们设置成256。</p>
<p>Grid Style：网格类型，有 No Grid, Minor Grid, Major Grid三种选项，这里我们选择No Grid。</p>
<p>Magnitude Display Scale：幅值显示类型，有Linear（线性的）Logarithmic（对数的），这里我们选择Linear。</p>
<p>Time Display Unit：显示时间的单位有sample, s, ms, us几种可选，其中sample表示显示的点的序号，这里我们选择ms。</p>
<p>Use Dc Value For Graph：是否使用Dc值，一般不常用，默认就行。</p>
<p>下图就是ua的波形：</p>
<p><img data-src="https://tvax2.sinaimg.cn/large/0084Tjdoly1gtssyykkfdj61fa0o97bh02.jpg"></p>
<p>但是不知道怎么观察扇区的波形，想看下扇区的变化对不对…</p>
<h3 id="星期三"><a href="#星期三" class="headerlink" title="星期三"></a>星期三</h3><p>把星期一的遗留问题进行了分析，将自己编写的SVPWM_Modified_3INT.c文件进行了修改，首先声明ePWM模块的初始化函数EPwmSetup()，由于A、B、C三相只需要用ePWM1、2、3模块，所以我将ePWM4、5、6的模块代码进行了注释，因为没有使用到这三个模块，代码对我来说就是多余的。</p>
<p>在初始化函数的文件DSP2833x_EPwm.c中，系统时钟为150MHz，PWM的频率设定为12.8kHz，死区时间设置为475，死区模式选择ALC模式。定义Uint16 T作为时基周期寄存器的值， T=CPU_CLK/(2×PWM_CLK)，所以T的值应该算到是5859。</p>
<p>之后声明ePWM1、2、3的初始化函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void InitPwm1AB(float32 f);</span><br><span class="line">void InitPwm2AB(float32 f);</span><br><span class="line">void InitPwm3AB(float32 f);</span><br></pre></td></tr></table></figure>
<p>以ePWM1模块的初始化函数举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">void InitPwm1AB(float32 f)</span><br><span class="line">&#123;</span><br><span class="line">	&#x2F;&#x2F;系统时钟SYSCLKOUT&#x3D;150MHz，TBCLK&#x3D;6.6666667ns，在连续增计数模式下，f&#x3D;150000000&#x2F;(TBPDR+1)</span><br><span class="line">	&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;Setup TBCLK P207、208页&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">	EPwm1Regs.TBPRD &#x3D; T; &#x2F;&#x2F;周期寄存器中设置计数器的计数周期  12.8k</span><br><span class="line">	EPwm1Regs.TBPHS.half.TBPHS &#x3D; 0x0000; &#x2F;&#x2F; 在相位寄存器中设置计数器的起始计数位置</span><br><span class="line">	EPwm1Regs.TBCTR &#x3D;0x0000; &#x2F;&#x2F;设置时基计数器计数初值从零开始计数</span><br><span class="line">	EPwm1Regs.CMPA.half.CMPA &#x3D;EPwm1Regs.TBPRD&gt;&gt;2;</span><br><span class="line">	&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;Setup TBCTL counter mode &#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">	EPwm1Regs.TBCTL.bit.CTRMODE &#x3D; TB_COUNT_UPDOWN; &#x2F;&#x2F;0x2&#x2F;&#x2F;设置计数模式位为连续增减计数模式，产生对称方波</span><br><span class="line">	EPwm1Regs.TBCTL.bit.PHSEN &#x3D; TB_DISABLE; &#x2F;&#x2F;0x0&#x2F;&#x2F;将定时器相位使能位关闭</span><br><span class="line">	EPwm1Regs.TBCTL.bit.HSPCLKDIV &#x3D; 0;&#x2F;&#x2F;TBCLK &#x3D; SYSCLKOUT &#x2F; (HSPCLKDIV × CLKDIV)</span><br><span class="line">	EPwm1Regs.TBCTL.bit.CLKDIV &#x3D; 0;&#x2F;&#x2F;值都为0说明系统时钟为150MHz</span><br><span class="line">	EPwm1Regs.TBCTL.bit.PRDLD &#x3D; TB_SHADOW;&#x2F;&#x2F;0x0&#x2F;&#x2F;映射寄存器SHADOW使能并配置映射寄存器为自动读写</span><br><span class="line">	EPwm1Regs.TBCTL.bit.SYNCOSEL &#x3D; TB_CTR_ZERO;&#x2F;&#x2F;0x1</span><br><span class="line">	&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;Setup shadowing P209页&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">	EPwm1Regs.CMPCTL.bit.SHDWAMODE &#x3D; CC_SHADOW;&#x2F;&#x2F;0x0&#x2F;&#x2F;A模块比较模式CC_SHADOW</span><br><span class="line">	EPwm1Regs.CMPCTL.bit.SHDWBMODE &#x3D; CC_SHADOW;&#x2F;&#x2F;0x0&#x2F;&#x2F;B模块比较模式</span><br><span class="line">	EPwm1Regs.CMPCTL.bit.LOADAMODE &#x3D; CC_CTR_ZERO;&#x2F;&#x2F;0x1 CTR&#x3D;Zero&#x2F;&#x2F; A模块比较使能,通过写0来清除SHDWAMODE位来使能load on</span><br><span class="line">	EPwm1Regs.CMPCTL.bit.LOADBMODE &#x3D; CC_CTR_ZERO; &#x2F;&#x2F; CTR&#x3D;Zero B模块比较使能，通过写0来清除SHDWBMODE位来使能load on</span><br><span class="line">	 &#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;Set actions P210、211、212、213页&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">#ifdef ACTV_LOW</span><br><span class="line">	EPwm1Regs.AQCTLA.bit.CAU &#x3D;AQ_SET;    &#x2F;&#x2F; 向上计数时，时基计数器的计数值&#x3D;比较值CMPA时ePWMA置位</span><br><span class="line">	EPwm1Regs.AQCTLA.bit.CAD &#x3D;AQ_CLEAR;  &#x2F;&#x2F; 向下计数时，时基计数器的计数值&#x3D;比较值CMPA时ePWMA清零</span><br><span class="line">	&#x2F;&#x2F;EPwm1Regs.AQCTLA.bit.PRD &#x3D; AQ_CLEAR;</span><br><span class="line">	EPwm1Regs.AQCTLB.bit.CBU &#x3D;AQ_CLEAR;  &#x2F;&#x2F; 向上计数时，时基计数器的计数值&#x3D;比较值CMPB时ePWMB清零</span><br><span class="line">	EPwm1Regs.AQCTLB.bit.CBD &#x3D; AQ_SET;   &#x2F;&#x2F; 向下计数时，时基计数器的计数值&#x3D;比较值CMPB时ePWMB置位</span><br><span class="line">	EPwm1Regs.AQCSFRC.all&#x3D;0x0;&#x2F;&#x2F;软件强制动作限定不使能</span><br><span class="line">#endif</span><br><span class="line">#ifdef ACTV_HIGH</span><br><span class="line">	EPwm1Regs.AQCTLA.bit.CAU &#x3D;AQ_CLEAR;   &#x2F;&#x2F; Set PWM1A on event A, up count</span><br><span class="line">	EPwm1Regs.AQCTLA.bit.CAD &#x3D;AQ_SET; &#x2F;&#x2F; Clear PWM1A on event A, down count</span><br><span class="line">	&#x2F;&#x2F;EPwm1Regs.AQCTLA.bit.PRD &#x3D; AQ_CLEAR;</span><br><span class="line">	EPwm1Regs.AQCTLB.bit.CBU &#x3D;AQ_SET;  &#x2F;&#x2F; Set PWM1B on event B, up count</span><br><span class="line">	EPwm1Regs.AQCTLB.bit.CBD &#x3D;AQ_CLEAR;  &#x2F;&#x2F; Clear PWM1B on event B, down count</span><br><span class="line">	EPwm1Regs.AQCSFRC.all&#x3D;0x0;&#x2F;&#x2F;软件强制动作限定不使能</span><br><span class="line">#endif</span><br><span class="line">	&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;Set the dead P213、214页&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">#ifdef ACTV_LOW</span><br><span class="line">	EPwm1Regs.DBCTL.bit.OUT_MODE &#x3D; DB_FULL_ENABLE;&#x2F;&#x2F;0x3：DB_FULL_ENABLE死区模块输出控制，使能双边沿延时</span><br><span class="line">	EPwm1Regs.DBCTL.bit.IN_MODE &#x3D; DBA_ALL;&#x2F;&#x2F;0x0：DBA_ALL；0x3：DBB_ALL死区模块输入控制，ePWMxA是双边沿延时输入沿（ePWMxB根据ePWMxA的上升沿和下降沿进行死区延时）</span><br><span class="line">	EPwm1Regs.DBCTL.bit.POLSEL &#x3D; DB_ACTV_LOC;&#x2F;&#x2F; 0x1：DB_ACTV_LOC；0x2：DB_ACTV_HIC;极性选择模块，由于输入源信号是ePWMxA，所以ePWMxA不翻转，ePWMxB翻转</span><br><span class="line">#endif</span><br><span class="line">#ifdef ACTV_HIGH</span><br><span class="line">	EPwm1Regs.DBCTL.bit.OUT_MODE &#x3D; DB_FULL_ENABLE;&#x2F;&#x2F;0x3：DB_FULL_ENABLE</span><br><span class="line">	EPwm1Regs.DBCTL.bit.IN_MODE &#x3D; DBA_ALL;&#x2F;&#x2F;0x0：DBA_ALL；0x3：DBB_ALL</span><br><span class="line">	EPwm1Regs.DBCTL.bit.POLSEL &#x3D; DB_ACTV_HIC;&#x2F;&#x2F; 0x1：DB_ACTV_LOC；0x2：DB_ACTV_HIC;</span><br><span class="line">#endif</span><br><span class="line">	EPwm1Regs.DBRED &#x3D; dead_time;&#x2F;&#x2F;设定上升沿死区时间</span><br><span class="line">	EPwm1Regs.DBFED &#x3D; dead_time;&#x2F;&#x2F;设定下降沿死区时间</span><br><span class="line"></span><br><span class="line">	EPwm1Regs.PCCTL.all&#x3D;0;&#x2F;&#x2F; 配置斩波模块 P215页，禁止斩波功能</span><br><span class="line">	EPwm1Regs.TZCTL.all&#x3D;0xf;&#x2F;&#x2F;配置错误联防模块 P217页，错误联防模块设置不起作用即 3~0对应1111&#x3D;0xf;</span><br><span class="line">	&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;Set ET P219、220页&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">	EPwm1Regs.ETSEL.bit.INTSEL &#x3D; ET_CTR_ZERO; &#x2F;&#x2F;当计数值CTR到0时候，ePWM1模块中断触发(更新比较寄存器CMPA和CMPB的值)</span><br><span class="line">	EPwm1Regs.ETSEL.bit.INTEN &#x3D; 1; &#x2F;&#x2F; ePWM1模块中断产生位，使能中断</span><br><span class="line">	EPwm1Regs.ETPS.bit.INTPRD &#x3D; 1;&#x2F;&#x2F;每次事件发生都触发中断，在第一个事件时，产生SOC信号，即SOCBCNT&#x3D;01，产生中断</span><br><span class="line">	&#x2F;&#x2F;AD触发设置</span><br><span class="line">&#x2F;&#x2F;	EPwm1Regs.ETSEL.bit.SOCAEN &#x3D; 1;  &#x2F;&#x2F; Enable SOC on A group</span><br><span class="line">&#x2F;&#x2F;	EPwm1Regs.ETSEL.bit.SOCASEL &#x3D; 4; &#x2F;&#x2F; Select SOC  from CPMA on upcount</span><br><span class="line">&#x2F;&#x2F;	EPwm1Regs.ETPS.bit.SOCAPRD &#x3D; 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同理其他两个模块也是一样设置，不再过多赘述<br>之后声明ePWM中断服务程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interrupt void epwm1_isr(void);&#x2F;&#x2F;声明EPWM1中断服务程序</span><br><span class="line">interrupt void epwm2_isr(void);&#x2F;&#x2F;声明EPWM2中断服务程序</span><br><span class="line">interrupt void epwm3_isr(void);&#x2F;&#x2F;声明EPWM3中断服务程序</span><br></pre></td></tr></table></figure>
<p>定义一些变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;由于载波设置的是12.8kHz，三相调制波的频率设置为50Hz，为256点采样</span><br><span class="line">#define PI 3.1415926</span><br><span class="line">float u_beta,u_alfa,u,m&#x3D;0.8;&#x2F;&#x2F;,temp_1, temp_2;</span><br><span class="line">float ua[256],ub[256],uc[256];</span><br><span class="line">float t1,t2,t0,t,X,Y,Z,sinne[256],cosne[256];</span><br><span class="line">Uint16 k&#x3D;0,k1&#x3D;0,k2&#x3D;0,k3&#x3D;0,n,A&#x3D;0,B&#x3D;0,C&#x3D;0,sec&#x3D;0;</span><br><span class="line">float Voltage1[256],Voltage2[256],Voltage3[256];&#x2F;&#x2F;ABC相观察用输出</span><br></pre></td></tr></table></figure>
<p>之后进入主函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">   InitSysCtrl();&#x2F;&#x2F;系统初始化</span><br><span class="line"></span><br><span class="line">   EALLOW;</span><br><span class="line">   SysCtrlRegs.HISPCP.all &#x3D; 0x3;&#x2F;&#x2F;ADC_MODCLK;	&#x2F;&#x2F; HSPCLK &#x3D; SYSCLKOUT&#x2F;ADC_MODCLK，设置ADC模式工作的标准频率，P323页</span><br><span class="line">   EDIS;</span><br><span class="line"></span><br><span class="line">   InitGpio();&#x2F;&#x2F;初始化GPIO，使用了DSP2833x_Gpio.c文件</span><br><span class="line">   InitXintf16Gpio();&#x2F;&#x2F;使用了DSP2833x_Xintf.c文件</span><br><span class="line"></span><br><span class="line">   DINT; &#x2F;&#x2F;禁止可屏蔽中断</span><br><span class="line"></span><br><span class="line">   InitPieCtrl();&#x2F;&#x2F;初始化PIE模块</span><br><span class="line"></span><br><span class="line">   IER &#x3D; 0x0000;&#x2F;&#x2F;禁止CPU中断</span><br><span class="line">   IFR &#x3D; 0x0000;&#x2F;&#x2F;清除所有CPU中断标志</span><br><span class="line"></span><br><span class="line">   InitPieVectTable();&#x2F;&#x2F;初始化中断向量表</span><br><span class="line">   InitAdc();&#x2F;&#x2F;初始化ADC模块，可以用ADC模块采样观察函数（之后学习）</span><br><span class="line"></span><br><span class="line">   EALLOW;  &#x2F;&#x2F; This is needed to write to EALLOW protected registers</span><br><span class="line">   PieVectTable.EPWM1_INT &#x3D; &amp;epwm1_isr;&#x2F;&#x2F;重新映射使用的中断向量，对应的地址P134页</span><br><span class="line">   PieVectTable.EPWM2_INT &#x3D; &amp;epwm2_isr;</span><br><span class="line">   PieVectTable.EPWM3_INT &#x3D; &amp;epwm3_isr;</span><br><span class="line">   EDIS;    &#x2F;&#x2F; This is needed to disable write to EALLOW protected registers</span><br><span class="line"></span><br><span class="line">   EALLOW;</span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.TBCLKSYNC &#x3D; 0;&#x2F;&#x2F;停止所有ePWM模块的时钟</span><br><span class="line">   EDIS;</span><br><span class="line"></span><br><span class="line">   EPwmSetup();&#x2F;&#x2F;初始化EPwm1、2、3模块</span><br><span class="line"></span><br><span class="line">   EALLOW;</span><br><span class="line">   SysCtrlRegs.PCLKCR0.bit.TBCLKSYNC &#x3D; 1;&#x2F;&#x2F;允许所有ePWM模块的时钟</span><br><span class="line">   EDIS;</span><br><span class="line"></span><br><span class="line">   IER |&#x3D; M_INT3;&#x2F;&#x2F;允许CPU的INT3（对应的是EPWM1~6）</span><br><span class="line"></span><br><span class="line">   PieCtrlRegs.PIEIER3.bit.INTx1 &#x3D; 1;&#x2F;&#x2F;允许PIE级中断INT3.1，即EPWM1中断</span><br><span class="line">   PieCtrlRegs.PIEIER3.bit.INTx2 &#x3D; 1;&#x2F;&#x2F;允许PIE级中断INT3.2，即EPWM2中断</span><br><span class="line">   PieCtrlRegs.PIEIER3.bit.INTx3 &#x3D; 1;&#x2F;&#x2F;允许PIE级中断INT3.3，即EPWM3中断</span><br><span class="line"></span><br><span class="line">   EINT;   &#x2F;&#x2F; Enable Global interrupt INTM</span><br><span class="line">   ERTM;   &#x2F;&#x2F; Enable Global realtime interrupt DBGM</span><br><span class="line">   for(n&#x3D;0;n&lt;256;n++)&#x2F;&#x2F;准备好三相的波形</span><br><span class="line">   &#123;</span><br><span class="line">	   ua[n] &#x3D; cos(2*PI*n&#x2F;256);</span><br><span class="line">	   ub[n] &#x3D; cos(2*PI*n&#x2F;256-2*PI&#x2F;3);</span><br><span class="line">	   uc[n] &#x3D; cos(2*PI*n&#x2F;256+2*PI&#x2F;3);</span><br><span class="line">&#x2F;&#x2F;	   cosne[n] &#x3D; 2&#x2F;3*(ua[n]-0.5*ub[n]-0.5*uc[n]);</span><br><span class="line">&#x2F;&#x2F;	   sinne[n] &#x3D; sqrt(3)&#x2F;3*(ub[n]-uc[n]);</span><br><span class="line">&#x2F;&#x2F;	   sinne[n]&#x3D; sin(n*(6.283&#x2F;256));&#x2F;&#x2F;正余弦表初始化</span><br><span class="line">&#x2F;&#x2F;	   cosne[n]&#x3D; cos(n*(6.283&#x2F;256));</span><br><span class="line">   &#125;</span><br><span class="line">   n&#x3D;0;</span><br><span class="line"></span><br><span class="line">   for(;;)</span><br><span class="line">   &#123;</span><br><span class="line">       asm(&quot;          NOP&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>中断服务子程序，以epwm1_isr()函数为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">interrupt void epwm1_isr(void)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;将ua、ub、uc数组进行Clarke变换，m是调制比</span><br><span class="line">	u_alfa&#x3D;m*2&#x2F;3*(ua[k1]-0.5*ub[k1]-0.5*uc[k1]);</span><br><span class="line">	u_beta&#x3D;m*sqrt(3)&#x2F;3*(ub[k1]-uc[k1]);</span><br><span class="line">    &#x2F;&#x2F;确定XYZ的值，详见自己的总结文档，这里的XYZ是标幺值</span><br><span class="line">    X&#x3D;u_beta;</span><br><span class="line">    Y&#x3D;0.867*u_alfa-0.5*u_beta;</span><br><span class="line">    Z&#x3D;-0.867*u_alfa-0.5*u_beta;</span><br><span class="line">    &#x2F;&#x2F;用X、Y、Z可以判断扇区，sec&#x3D;315462分别对应扇区123456</span><br><span class="line">    if(X&gt;0) A&#x3D;1;</span><br><span class="line">    else A&#x3D;0;</span><br><span class="line">    if(Y&gt;0) B&#x3D;1;</span><br><span class="line">    else B&#x3D;0;</span><br><span class="line">    if(Z&gt;0) C&#x3D;1;</span><br><span class="line">    else C&#x3D;0;</span><br><span class="line">    sec&#x3D;4*C+2*B+A;</span><br><span class="line"></span><br><span class="line">switch(sec)</span><br><span class="line">&#123;</span><br><span class="line">	case 1: &#x2F;&#x2F;2扇区</span><br><span class="line">        t1&#x3D;-Y;&#x2F;&#x2F;时间归一化相当于Ts取1，Vdc取sqrt(3)</span><br><span class="line">        t2&#x3D;-Z;&#x2F;&#x2F;这里的t1、t2是广义的t1、t2，奇偶扇区已经交换</span><br><span class="line">        t0&#x3D;1-t1-t2;</span><br><span class="line">        EPwm1Regs.CMPA.half.CMPA &#x3D; ((t0&#x2F;2)+t1)*EPwm1Regs.TBPRD; &#x2F;&#x2F;</span><br><span class="line">        EPwm1Regs.CMPB &#x3D; (t0&#x2F;2+t1)*EPwm1Regs.TBPRD; &#x2F;&#x2F;</span><br><span class="line">        break;</span><br><span class="line">    case 2:&#x2F;&#x2F;6扇区</span><br><span class="line">        t1&#x3D;-Z;&#x2F;&#x2F;时间归一化相当于Ts取1，Vdc取sqrt(3)</span><br><span class="line">        t2&#x3D;-X;</span><br><span class="line">        t0&#x3D;1-t1-t2;</span><br><span class="line">        EPwm1Regs.CMPA.half.CMPA &#x3D;(t0*EPwm1Regs.TBPRD)&#x2F;2; &#x2F;&#x2F;</span><br><span class="line">        EPwm1Regs.CMPB &#x3D; (t0*EPwm1Regs.TBPRD)&#x2F;2; &#x2F;&#x2F;</span><br><span class="line">        break;</span><br><span class="line">    case 3:&#x2F;&#x2F;1扇区</span><br><span class="line">        t1&#x3D;Y;</span><br><span class="line">        t2&#x3D;X;</span><br><span class="line">        t0&#x3D;1-t1-t2;</span><br><span class="line">        t&#x3D;t1+t2;</span><br><span class="line">        EPwm1Regs.CMPA.half.CMPA &#x3D;(t0*(EPwm1Regs.TBPRD))&#x2F;2; &#x2F;&#x2F;</span><br><span class="line">        EPwm1Regs.CMPB &#x3D;(t0*(EPwm1Regs.TBPRD))&#x2F;2; &#x2F;&#x2F;</span><br><span class="line">        break;</span><br><span class="line">    case 4:&#x2F;&#x2F;4扇区</span><br><span class="line">        &#x2F;&#x2F;temp_1&#x3D;-X;</span><br><span class="line">        &#x2F;&#x2F;temp_2&#x3D;-Y;</span><br><span class="line">        t1&#x3D;-X;</span><br><span class="line">        t2&#x3D;-Y;</span><br><span class="line">        t0&#x3D;1-t1-t2;</span><br><span class="line">        EPwm1Regs.CMPA.half.CMPA &#x3D;(t0&#x2F;2+t1+t2)*EPwm1Regs.TBPRD; &#x2F;&#x2F;</span><br><span class="line">        EPwm1Regs.CMPB &#x3D; (t0&#x2F;2+t1+t2)*EPwm1Regs.TBPRD; &#x2F;&#x2F;</span><br><span class="line">        break;</span><br><span class="line">    case 5:&#x2F;&#x2F;3扇区</span><br><span class="line">        &#x2F;&#x2F; temp_1&#x3D;X;</span><br><span class="line">        &#x2F;&#x2F; temp_2&#x3D;Z;</span><br><span class="line">        t1&#x3D;X;</span><br><span class="line">        t2&#x3D;Z;</span><br><span class="line">        t0&#x3D;1-t1-t2;</span><br><span class="line">        EPwm1Regs.CMPA.half.CMPA &#x3D;(t0&#x2F;2+t1+t2)*EPwm1Regs.TBPRD; &#x2F;&#x2F;</span><br><span class="line">        EPwm1Regs.CMPB &#x3D; (t0&#x2F;2+t1+t2)*EPwm1Regs.TBPRD;</span><br><span class="line">        break;</span><br><span class="line">    case 6:&#x2F;&#x2F;5扇区</span><br><span class="line">        &#x2F;&#x2F;temp_1&#x3D;Z;</span><br><span class="line">        &#x2F;&#x2F;temp_2&#x3D;Y;</span><br><span class="line">        t1&#x3D;Z;</span><br><span class="line">        t2&#x3D;Y;</span><br><span class="line">        t0&#x3D;1-t1-t2;</span><br><span class="line">        EPwm1Regs.CMPA.half.CMPA &#x3D; ((t0&#x2F;2)+t1)*EPwm1Regs.TBPRD; &#x2F;&#x2F;</span><br><span class="line">        EPwm1Regs.CMPB &#x3D; (t0&#x2F;2+t1)*EPwm1Regs.TBPRD; &#x2F;&#x2F;</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br><span class="line">    &#x2F;&#x2F;Voltage1[k]&#x3D;EPwm1Regs.CMPA.half.CMPA ;&#x2F;&#x2F;观察用</span><br><span class="line">    Voltage1[k1]&#x3D;t0;</span><br><span class="line">   	k1++;</span><br><span class="line">	if(k1&gt;&#x3D;256) k1&#x3D;0;</span><br><span class="line"></span><br><span class="line">   EPwm1Regs.ETCLR.bit.INT &#x3D; 1;             &#x2F;&#x2F;清除标志位</span><br><span class="line">   PieCtrlRegs.PIEACK.all &#x3D; PIEACK_GROUP3;  &#x2F;&#x2F;清除应答位</span><br><span class="line">   EINT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="星期四"><a href="#星期四" class="headerlink" title="星期四"></a>星期四</h3><p>感觉昨天的代码逻辑有点复杂，于是就重新修改了自己主函数的逻辑，在主函数中先准备好三相波形，并进行Clarke变化，存入定义的数组中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for(n&#x3D;0;n&lt;256;n++)&#x2F;&#x2F;准备好三相的波形</span><br><span class="line">&#123;</span><br><span class="line"> ua[n] &#x3D; m*Vdc&#x2F;sqrt(3)*cos(2*PI*n&#x2F;256);</span><br><span class="line"> ub[n] &#x3D; m*Vdc&#x2F;sqrt(3)*cos(2*PI*n&#x2F;256-2*PI&#x2F;3);</span><br><span class="line"> uc[n] &#x3D; m*Vdc&#x2F;sqrt(3)*cos(2*PI*n&#x2F;256+2*PI&#x2F;3);</span><br><span class="line"> cosne[n] &#x3D; (double)2.0&#x2F;3*(ua[n]-0.5*ub[n]-0.5*uc[n]);</span><br><span class="line"> sinne[n] &#x3D; sqrt(3)&#x2F;3*(ub[n]-uc[n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后重新修改了三相的中断函数的代码，首先将存入数组中的Clarke变换的数据逐一取出，由自己分析的《关于SVPWM扇区判断以及矢量作用时间的理解》，定义三个变量X1、Y1、Z1用来确定扇区，X、Y、Z用来确定六个扇区对应的矢量作用时间，首先根据X1、Y1、Z1确定N的值，N的值和扇区号是一一对应的，所以之后利用一个Switch函数，将数字N转化成对应的扇区号sec，这样sec[1-6]对应的就是扇区I-VI，之后根据扇区确定标准矢量的作用时间，得到t1、t2、t0与X、Y、Z的关系表， 之后对t1、t2进行饱和处理，定义三个时刻Taon、Tbon、Tcon，根据扇区分别确定A、B、C相的切换时刻Ta、Tb、Tc，最后将Ta、Tb、Tc进行归一化后，给对应的ePWM模块的比较寄存器的值，由于ePWM已经初始化好了，不需要再修改，ePWM1模块的中断服务子程序完成如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">interrupt void epwm1_isr(void)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;将ua、ub、uc数组进行Clarke变换，m是调制比</span><br><span class="line">	u_alfa&#x3D;cosne[k1];</span><br><span class="line">	u_beta&#x3D;sinne[k1];</span><br><span class="line">    &#x2F;&#x2F;确定XYZ的值，详见自己的总结文档，这里的XYZ是标幺值</span><br><span class="line">    X1&#x3D;u_beta;</span><br><span class="line">    Y1&#x3D;0.867*u_alfa-0.5*u_beta;</span><br><span class="line">    Z1&#x3D;-0.867*u_alfa-0.5*u_beta;</span><br><span class="line">    X &#x3D; sqrt(3)*Ts&#x2F;Vdc*X1;&#x2F;&#x2F;计算真正的矢量作量时间XYZ的值</span><br><span class="line">    Y &#x3D; sqrt(3)*Ts&#x2F;Vdc*Y1;</span><br><span class="line">    Z &#x3D; sqrt(3)*Ts&#x2F;Vdc*Z1;</span><br><span class="line">    &#x2F;&#x2F;用X、Y、Z可以判断扇区，sec&#x3D;315462分别对应扇区123456</span><br><span class="line">    if(X1&gt;0) A&#x3D;1;</span><br><span class="line">    else A&#x3D;0;</span><br><span class="line">    if(Y1&gt;0) B&#x3D;1;</span><br><span class="line">    else B&#x3D;0;</span><br><span class="line">    if(Z1&gt;0) C&#x3D;1;</span><br><span class="line">    else C&#x3D;0;</span><br><span class="line">    N&#x3D;4*C+2*B+A;</span><br><span class="line">    &#x2F;&#x2F;将数字N转化成对应的扇区号</span><br><span class="line">    switch(N)</span><br><span class="line">    &#123;</span><br><span class="line">    case 1: &#123;sec&#x3D;2; break;&#125;</span><br><span class="line">    case 2: &#123;sec&#x3D;6; break;&#125;</span><br><span class="line">    case 3: &#123;sec&#x3D;1; break;&#125;</span><br><span class="line">    case 4: &#123;sec&#x3D;4; break;&#125;</span><br><span class="line">    case 5: &#123;sec&#x3D;3; break;&#125;</span><br><span class="line">    case 6: &#123;sec&#x3D;5; break;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;根据参考电压矢量所在的扇区确定标准矢量的作用时间</span><br><span class="line">    switch(sec)</span><br><span class="line">    &#123;</span><br><span class="line">    case 1: &#123;t1&#x3D;Y;  t2&#x3D;X;  t0&#x3D;Ts-t1-t2; break;&#125;</span><br><span class="line">    case 2: &#123;t1&#x3D;-Y; t2&#x3D;-Z; t0&#x3D;Ts-t1-t2; break;&#125;</span><br><span class="line">    case 3: &#123;t1&#x3D;X;  t2&#x3D;Z;  t0&#x3D;Ts-t1-t2; break;&#125;</span><br><span class="line">    case 4: &#123;t1&#x3D;-X; t2&#x3D;-Y; t0&#x3D;Ts-t1-t2; break;&#125;</span><br><span class="line">    case 5: &#123;t1&#x3D;Z;  t2&#x3D;Y;  t0&#x3D;Ts-t1-t2; break;&#125;</span><br><span class="line">    case 6: &#123;t1&#x3D;-Z; t2&#x3D;-X; t0&#x3D;Ts-t1-t2; break;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;将T1、T2进行饱和处理</span><br><span class="line">    if(t1+t2&gt;Ts)</span><br><span class="line">    &#123;</span><br><span class="line">    	t1&#x3D;t1*Ts&#x2F;(t1+t2);</span><br><span class="line">    	t2&#x3D;t2*Ts&#x2F;(t1+t2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Taon&#x3D;t0&#x2F;4;</span><br><span class="line">    Tbon&#x3D;t0&#x2F;4+t1&#x2F;2;</span><br><span class="line">    Tcon&#x3D;t0&#x2F;4+t1&#x2F;2+t2&#x2F;2;</span><br><span class="line"></span><br><span class="line">    switch(sec)</span><br><span class="line">    &#123;</span><br><span class="line">    case 1: &#123;Ta&#x3D;Taon; Tb&#x3D;Tbon; Tc&#x3D;Tcon; break;&#125;</span><br><span class="line">    case 2: &#123;Ta&#x3D;Tbon; Tb&#x3D;Taon; Tc&#x3D;Tcon; break;&#125;</span><br><span class="line">    case 3: &#123;Ta&#x3D;Tcon; Tb&#x3D;Taon; Tc&#x3D;Tbon; break;&#125;</span><br><span class="line">    case 4: &#123;Ta&#x3D;Tcon; Tb&#x3D;Tbon; Tc&#x3D;Taon; break;&#125;</span><br><span class="line">    case 5: &#123;Ta&#x3D;Tbon; Tb&#x3D;Tcon; Tc&#x3D;Taon; break;&#125;</span><br><span class="line">    case 6: &#123;Ta&#x3D;Taon; Tb&#x3D;Tcon; Tc&#x3D;Tbon; break;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    EPwm1Regs.CMPA.half.CMPA &#x3D;Ta*EPwm1Regs.TBPRD&#x2F;(Ts&#x2F;2);</span><br><span class="line">    EPwm1Regs.CMPB &#x3D;Ta*EPwm1Regs.TBPRD&#x2F;(Ts&#x2F;2);</span><br><span class="line">    &#x2F;&#x2F;Voltage1[k]&#x3D;EPwm1Regs.CMPA.half.CMPA ;&#x2F;&#x2F;观察用</span><br><span class="line">    Voltage1[k1]&#x3D;Ta;</span><br><span class="line">   	k1++;</span><br><span class="line">	if(k1&gt;&#x3D;256) k1&#x3D;0;</span><br><span class="line">	EPwm1Regs.ETCLR.bit.INT &#x3D; 1;             &#x2F;&#x2F;清除标志位</span><br><span class="line">	PieCtrlRegs.PIEACK.all &#x3D; PIEACK_GROUP3;  &#x2F;&#x2F;清除应答位</span><br><span class="line">	EINT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序能够正常编译，运行之后，利用Graph可以观察ABC相的波形，由于每次Graph只能查看一个变量的波形，所以将三相变量的数据导出成.CSV文件，并利用Excel绘制散点图，即可观察ABC三相切换时刻的波形图，并与自己用Matlab仿真得到的Ta、Tb、Tc的波形进行了比较：</p>
<p><img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gtw93tq6zyj60eb08hq4x02.jpg" alt="CCS编程实现的Ta、Tb、Tc波形图"></p>
<p><img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gtw94dgg93j60dd080gng02.jpg" alt="Matlab仿真实现的Ta、Tb、Tc波形图"></p>
<p>可以发现波形基本吻合，Ta、Tb、Tc相差120°，一个周期是50Hz。将程序烧写到DSP中，得到的PWM的波形为下图：</p>
<p><img data-src="https://tva4.sinaimg.cn/large/0084Tjdoly1gtw9cl7xk2j61400u0n1e02.jpg" alt="输出的PWM波形"></p>
<h3 id="星期五"><a href="#星期五" class="headerlink" title="星期五"></a>星期五</h3><p>和老师交流之后，下一步需要在实现编程的基础上进行修改，但是因为每一个载波频率之后我都需要将载波频率实时进行修改，那么我之前提前给好三相电压数组的逻辑就有问题，我不能再用定256点，也就是12.8kHz/50Hz来确定，而是需要设定一个时间，这个时间用来确定三相的相位，利用cos来确定对应的值，经过Clarke变换，之后再确定Ta、Tb、Tc，由于我需要将ePWM模块的时基周期寄存器的值实时变动，暂时先计数10000次然后改变Ts的值，即改变TBPRD的值，一个TBPRD计数之后就是一个Ts，那么可以设定一个时间Tctr=Tctr+2×TBPRD×TBCLK，并设定一个循环让k增加一次，就改变一次时间，并把这个时刻对应的三相电压值确定好给入数组，之后进行相同操作确定Ta、Tb、Tc，TBPRD的值也相应改变了，将其给如比较寄存器，进行一个载波周期的比较。</p>
<p>按照上述逻辑进行了代码的相关修改，为了代码报错后能更快还原到老版本，将老的的代码进行了备份，新的的代码根据修改日期重新命名成：SVPWM_Modified_3INT_0827.c</p>
<p>修改的逻辑如下，主函数一个for循环进行计数并修改TBPRD的值，之后给tctr1、2、3进行赋新值，由于for循环是在一直循环的，所以tctr应该是一直在加。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">for(;;)</span><br><span class="line">&#123;</span><br><span class="line"> if(0&#x3D;&lt;k&lt;&#x3D;128000)</span><br><span class="line"> &#123;</span><br><span class="line">  Ts&#x3D;(double)1&#x2F;12800;</span><br><span class="line">  EPwm1Regs.TBPRD&#x3D;1500000000&#x2F;(2*1&#x2F;Ts);</span><br><span class="line">  k++;</span><br><span class="line"> &#125;</span><br><span class="line"> else if(128000&lt;k&lt;&#x3D;256000)</span><br><span class="line"> &#123;</span><br><span class="line">  Ts&#x3D;(double)1&#x2F;25600;</span><br><span class="line">  EPwm1Regs.TBPRD&#x3D;1500000000&#x2F;(2*1&#x2F;Ts);</span><br><span class="line">  k++;</span><br><span class="line"> &#125;</span><br><span class="line"> else</span><br><span class="line"> &#123;</span><br><span class="line">  Ts&#x3D;(double)1&#x2F;12800;</span><br><span class="line">  EPwm1Regs.TBPRD&#x3D;1500000000&#x2F;(2*1&#x2F;Ts);</span><br><span class="line">  k&#x3D;0;</span><br><span class="line"> &#125;</span><br><span class="line"> tctr1&#x3D;tctr1+(double)2*EPwm1Regs.TBPRD*1&#x2F;150000000;</span><br><span class="line"> tctr2&#x3D;tctr2+(double)2*EPwm1Regs.TBPRD*1&#x2F;150000000;</span><br><span class="line"> tctr3&#x3D;tctr3+(double)2*EPwm1Regs.TBPRD*1&#x2F;150000000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后对中断服务子程序进行相应的修改，以A相的Epwm1模块为例，首先将tctr1时刻对应的cos三相的电压存入数组，并进行Clarke变换，之后将k1++，当一个周期即当50×tctr1=1时，将tctr1置零，k1置零，进入下一个调制波的周期，重新计数…后面的确定矢量作用时间基本一样，不再赘述，新增的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ua[k1]&#x3D;cos(100*PI*tctr1);</span><br><span class="line">ub[k1]&#x3D;cos(100*PI*tctr1-2*PI&#x2F;3);</span><br><span class="line">uc[k1]&#x3D;cos(100*PI*tctr1+2*PI&#x2F;3);</span><br><span class="line">cosne[k1] &#x3D; (double)2.0&#x2F;3*(ua[k1]-0.5*ub[k1]-0.5*uc[k1]);</span><br><span class="line">sinne[k1] &#x3D; sqrt(3)&#x2F;3*(ub[k1]-uc[k1]);</span><br><span class="line">   &#x2F;&#x2F;将ua、ub、uc数组进行Clarke变换，m是调制比</span><br><span class="line">u_alfa&#x3D;cosne[k1];</span><br><span class="line">u_beta&#x3D;sinne[k1];</span><br><span class="line">  	k1++;</span><br><span class="line">if(50*tctr1&#x3D;1)</span><br><span class="line">&#123;</span><br><span class="line">	tctr1&#x3D;0;</span><br><span class="line">	k1&#x3D;0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后重新编译报错了😭，不知道为什么……👴累了，心累💔，好烦！！！</p>
<p>晚上试了下怎么将Tek示波器的波形导出到U盘：</p>
<p>科研需要将示波器的波形导出到U盘进行观察和分析，想要把示波器的数据导出到电脑进行观看，那么怎么将示波器的波形进行导出呢？</p>
<p>本人使用的示波器的型号为：Tektronix DPO 2012B Digital Phosphor Oscilloscope</p>
<p>首先将U盘插入到USB接口中，之后点击<code>Menu</code>按钮，选择<code>Save Waveform</code>：</p>
<p><img data-src="https://tvax1.sinaimg.cn/large/0084Tjdoly1gtwa7dgsxij63402c0u1002.jpg"></p>
<p>右边的<code>source</code>选择信号1，<code>Destination</code>选择SpreadsheetFile(.csv)，<code>Waveform Resolution</code>波形分辨率选择Full，<code>Gating</code>根据需求选择Off、Screen、Between Cusors，之后点击<code>Save…</code>即可！</p>
<p><img data-src="https://tvax4.sinaimg.cn/large/0084Tjdoly1gtwa88erksj63402c0u1002.jpg"></p>
<p>之后U盘里面就会多一个.CSV的文件，将U盘插入电脑，就可以画散点图查看波形了！</p>
<p><img data-src="https://tvax1.sinaimg.cn/large/0084Tjdoly1gtwb57ci79j60dd081my902.jpg"></p>
<h3 id="星期六"><a href="#星期六" class="headerlink" title="星期六"></a>星期六</h3><p>昨天没有编译成功的程序，今天好像突然能编译成功了，不知道什么原因，难道是我重启了一下CCS软件就能编译了吗？很奇怪…</p>
<p>但是发现编译成功之后波形不正确，和老师交流之后，应该是时间没有弄好，必须要确定好程序运行的时间，我的思路是进入中断之后开始计时，先这样吧！</p>
<h2 id="一些感悟🤯"><a href="#一些感悟🤯" class="headerlink" title="一些感悟🤯"></a>一些感悟🤯</h2><p>最近师兄师姐已经开始准备找工作了，看他们在准备面试啥的，还有点焦虑，问老师找工作有什么建议，老师直接批我说你现在还不用想那么远的事，确实，还是先踏实过好每一天吧，与其每天焦虑未来，不如让今天更充实点…</p>
<p>但是看到这个就想😭👇</p>
<p><a target="_blank" rel="noopener" href="http://www.moe.gov.cn/jyb_sjzl/sjzl_fztjgb/202108/t20210827_555004.html">2020年全国教育事业发展统计公报</a></p>
<p>全国共有普通高校2738所，比上年增加50所。其中，本科院校1270所（含本科层次职业学校21所），比上年增加5所；高职（专科）院校1468所，比上年增加45所。成人高等学校265所，比上年减少3所；研究生培养机构827个，其中，普通高等学校594个，科研机构233个。</p>
<p><strong>研究生招生110.66万人，比上年增加19.00万人，增长20.74%。其中，博士生11.60万人，硕士生99.05万人。在学研究生313.96万人，比上年增加27.59万人，增长9.63%。其中，博士生46.65万人，在学硕士生267.30万人。毕业研究生72.86万人，其中，毕业博士生6.62万人，毕业硕士生66.25万人。</strong></p>
<h2 id="哲思学意📚"><a href="#哲思学意📚" class="headerlink" title="哲思学意📚"></a>哲思学意📚</h2><p>放缓节奏并记住：我们所做的绝大多数事情都不会有什么明显结果，忙忙碌碌常常是思想惰性的表现形式，懒得思考、盲目行动。——蒂姆</p>
<p>毋意，毋必，毋固，毋我——孔子有“四不”，即不臆断，不绝对，不固执，不自以为是。</p>
<p>我们大可以活成我们自己，活得更本色一点、更真实一点，反正还是有人会喜欢你、有人会不喜欢你，但至少你会更喜欢你自己。——陈果</p>
<p>我们尽一切所能来对抗明天的不确定 。尽可能地赚钱 ,提升自己的地位 , 储备知识 , 积累人脉 , 来对抗这种不确定的人生 。但是 , 越多的积累却催生出更多的恐惧 , 我们越来越害怕失去已经拥有的一切 。我们陷入一种深深的自欺 ,那就是用表面的 “强大 ”来掩盖自己有限 、脆弱与无奈的本相 。然而 , 我们是绝对依赖的物种 , 我们不可能仅靠着自己就获得生存 , 这种绝对的依赖感是我们的本相 , 也是很多人一生与之相随的恐惧感的来源 。因此 , 人只有承认并接受自己的本相 , 才能除去自欺所带来的恐惧 。我们必须接受这样一个事实 , 那就是没有人能活在确定性之中 , 对人生而言 ,我们唯一能确定的就是不确定的人生 。 ——罗翔</p>
<p>无论是走在前面还是走在后面都没有关系，我们都走在一个并不存在纵轴的水平面上，我们不断向前迈进并不是为了与谁竞争。价值在于不断超越自我。——《被讨厌的勇气》</p>
<p>Recognise，the excuses are not valid. There’re conjured up, there’re fabricated, there’re lies. And how do you stop the lies? You stop the lies with the truth. and the truth is you have time, you have the skill, you have the knowledge and the support, and the will power, and the discipline, to get it done.</p>
<h2 id="休息娱乐😔"><a href="#休息娱乐😔" class="headerlink" title="休息娱乐😔"></a>休息娱乐😔</h2><p>这周没什么娱乐，感觉自己有点烦就练练字！</p>
<p><img data-src="https://tva3.sinaimg.cn/large/0084Tjdoly1gtwlqwi9wxj61l728mb0d02.jpg"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://ncepuee.github.io/2021/08/22/20210816-0822/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="菜菜的黄">
      <meta itemprop="description" content="记录科研生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="School boy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/22/20210816-0822/" class="post-title-link" itemprop="url">20210816-0822周报</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-22 08:00:00" itemprop="dateCreated datePublished" datetime="2021-08-22T08:00:00+08:00">2021-08-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="每周音乐🎵"><a href="#每周音乐🎵" class="headerlink" title="每周音乐🎵"></a>每周音乐🎵</h2><iframe frameborder="0" height="80" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;"  src="//music.163.com/outchain/player?type=2&id=411314681&auto=0&height=66"></iframe>

<h2 id="运动歌单🏃‍"><a href="#运动歌单🏃‍" class="headerlink" title="运动歌单🏃‍"></a>运动歌单🏃‍</h2><p>适合跑步运动的歌单（Music）</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="450" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/playlist/running-fitness-sports/pl.u-Ldbqel5u27kmjlm"></iframe>

<h2 id="学习进展✍"><a href="#学习进展✍" class="headerlink" title="学习进展✍"></a>学习进展✍</h2><h3 id="星期一"><a href="#星期一" class="headerlink" title="星期一"></a>星期一</h3><p>将CCS的SVPWM的代码成功运行，能看到脉冲波形，但是可能相位还是有点问题，所以暂时就没有继续改代码，代码感觉没什么问题，相位还不知道如何设置；</p>
<h3 id="星期二"><a href="#星期二" class="headerlink" title="星期二"></a>星期二</h3><p>将Clarke变换的理论和仿真进行了整理：</p>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/Clarke-Clarke-301400a20eb14e8f962e856d3f3a8f71">等幅值Clarke变换和等功率Clarke变换</a></p>
<p>将SVPWM的理论进行了重新回顾：</p>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/SVPWM-89b447306e0b4c859679265940c6c28b">空间矢量的概念和SVPWM的工作原理</a></p>
<p>将SVPWM的Simulink仿真进行回顾总结：</p>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/SVPWM-Simulink-406b4f843e644115935db13e7c74c873">SVPWM的Simulink建模仿真</a></p>
<blockquote>
<p>分析了为什么两种仿真的T0、T1、T2的波形不一致，找出了原因，并进行了总结，将两种生成SVPWM的脉冲的方法进行了汇总，扇区判断由于CCS编程使用的是N=4C+2B+A，所以Simulink的仿真中使用此方法来判断扇区。</p>
</blockquote>
<p>查找阅读基于Simulink的SVPWM自动代码生成的文献：</p>
<p><img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gtm4tmloxej60lc0fzn2502.jpg" alt="image"></p>
<h3 id="星期三"><a href="#星期三" class="headerlink" title="星期三"></a>星期三</h3><p>需要完成c2833x模块的参数设置，ePWMA和ePWMB模块的设置我的思路是输入占空比，由于是用时钟周期值，所以要将占空比转化成数字，求出TBPRD=1/12800/(2*(1/150000000))=5859，将三相的占空比乘以这个值就可以得到比较寄存器的值，将其输入作为比较寄存器CMPA和CMPB的值；三相电路所以用三个ePWM模块ePWM1、ePWM2、ePWM3，每个模块的ePWMA、ePWMB对应的是上下桥臂的脉冲。</p>
<blockquote>
<p>由于是向上向下计数，比较寄存器的值由归一化的占空比输入，乘以TBPRD的值，得到数值，之后可以进行比较，输入为CMPA和CMPB的值。</p>
</blockquote>
<p>ePWMA设置时钟周期，通过输入确定CMPA的值，当时基计数器等于零时，清零，当向上计数时，时基计数器等于比较寄存器CMPA的值时，将ePWMA进行翻转，当向下计数时，时基计数器等于比较寄存器CMPA的值时，将ePWMA清零。</p>
<p>ePWMB设置时钟周期，通过输入确定CMPB的值，当时基计数器等于零时，置位，当向上计数时，时基计数器等于比较寄存器CMPB的值时，将ePWMB进行翻转，当向下计数时，时基计数器等于比较寄存器CMPB的值时，将ePWMB置位。</p>
<p>将ePWMB模块设置死区时间，上升沿和下降沿都设置3μs的死区时间，数字为475（参考相关文献设置）。</p>
<p>波形发现很奇怪，为什么占空比全是一样的……？我觉得自己的分析没有问题…</p>
<p><img data-src="https://tvax3.sinaimg.cn/large/0084Tjdoly1gtm4ul5ri4j61jk15ob2902.jpg" alt="image"></p>
<p>重新理解：如果用切换时刻Ta、Tb、Tc作为比较寄存器的输入值，那么我的目的是为了让硬件输出相同的占空比罢了，我仿真的Ta、Tb、Tc的切换时刻，最后要和一个三角波进行比较：</p>
<p><img data-src="https://tvax2.sinaimg.cn/large/0084Tjdoly1gtm4vyk7wtj615x0mgtby02.jpg" alt="image"></p>
<p>当我的时刻比Ta、Tb、Tc大时，就将其置高电平，否则置低电平，最后得到的是0101的脉冲波形，所以我们要在F28335中实现同样的脉冲波形的话，那么如果用向上向下计数模式，和这个比较其实是一样的意思，我们知道向上向下计数，计完之后就是一个脉冲周期Tpwm（Ts）</p>
<p>在仿真中的比较是x=y的比较，当Ts/2时，y为Ts/2，当比Ta大时，置高电平，当比Tb大时，置高电平，当比Tc大时，置高电平。比三者小时，就是低电平；</p>
<p>但是在F28335中的ePWM模块，设置为向上向下计数时，计数计完之后，对应的时长为Tpwm（Ts）所以和仿真对比，x的变化是一样的，但是y不一样，所以同样的时刻对应的值不一样，所以将Ta、Tb、Tc输入到ePWM模块中时需要将其除以Ts/2之后再乘以TBPRD，将三个值分别作为CMPA和CMPB寄存器的值，CMPA寄存器作为上桥臂的比较值，CMPB寄存器作为下桥臂的比较值，ePWMA初始状态为低电平（时基计数器为0时），当时基计数器大于CMPA寄存器的值时，ePWMA置高电平，当时基计数器的值小于CMPA寄存器的值时，ePWMA清零；ePWMB初始状态为高电平（时基计数器为0时），当时基计数器大于CMPB寄存器的值时，置低电平，当时基计数器小于CMPB寄存器的值时，置高电平。</p>
<p><img data-src="https://tva3.sinaimg.cn/large/0084Tjdoly1gtm4wflnirj61jk0kq7r202.jpg" alt="image"></p>
<p>然后运行程序也没有报错，但是就是出来波形感觉不对因为占空比好像都一样……自己感觉分析没有问题。查看了文献也是这样操作。</p>
<h3 id="星期四"><a href="#星期四" class="headerlink" title="星期四"></a>星期四</h3><p>和牛老师进行了交流，根据牛老师的指导，换了一个思路，先做一个SPWM的Simulink模型，然后看能不能出波形：</p>
<p>首先搭建了一个SPWM的模型，输入三相对称的交流余弦波，由于要与载波进行比较，所以设置正弦波发生器幅值为1，然后将其加1，得到在0~1变化的三相对称的余弦波形；</p>
<p>为了和向上向下的载波进行比较，载波设置的频率为12.8kHz，系统频率设置为150MHz，所以TBPRD=5859，要和这样的载波比较的话，就需要将余弦波的幅值在(0,5859)变化，所以在上述的基础上乘以一个系数5859，这样就可以实现比较了。</p>
<p>然后设置ePWM模块：</p>
<p><img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gtm4y5hdo1j60k80kv7bw02.jpg" alt="image"></p>
<p>ePWMA和ePWMB中已经设置了更新比较寄存器的值，在Compare Value Reload Condition中当时基计数器等于零的时候装载比较寄存器的值。所以后面就可以不用设置中断了~</p>
<p><img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gtm4ytk7zqj60k80kvn6v02.jpg" alt="image"></p>
<p><img data-src="https://tva4.sinaimg.cn/large/0084Tjdoly1gtm4z9357bj60k80kvk0z02.jpg" alt="image"></p>
<p>我发现如果同时输入CMPA和CMPB为相同值，如果ePWMB也设置Input，最后输出的PWM的频率会变成两倍，我设置的载波频率为12.8kHz，但是如果ePWMB的CMPB也设置input，则频率就变成了25.6kHz，也就是设置的频率的两倍。所以不要设置CMPB，设置一个比较寄存器的输入值即可！用CMPA就不用CMPB比较寄存器。<strong>（星期四下午更新：好像设置了还是不行还是一样的频率🤦‍）</strong></p>
<p><img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gtm5073e5cj61jk15oe8102.jpg" alt="image"></p>
<p>之后是设置死区模块，数字为950时对应的死区时间大致是6μs，使能ePWMA和ePWMB的死区模块，之后设置死区的模式，有AHC、ALC、AH、AL，对应的输出波形如上图右边所示。RED和FED分别对应的是波形的上升沿和下降沿，以此为基础进行延时。其他的几个模块可以不用。</p>
<p>最后点击<code>Ctrl+B</code>即可编译程序并加载到F28335，板子上面的1对应的ePWM1的ePWMA模块，2对应ePWM1的ePWMB模块。将杜邦线接到上面，在示波器上进行显示。</p>
<h3 id="星期五"><a href="#星期五" class="headerlink" title="星期五"></a>星期五</h3><p>终于实现了Matlab的仿真！太赞了，感谢牛老师的帮助！</p>
<p>下面的视频请翻墙观看😅</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/m0qA1nVFbRg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="星期六"><a href="#星期六" class="headerlink" title="星期六"></a>星期六</h3><p>关于时钟频率的一些问题分析：我是按照增减模式的公式求TBPRD的值，根据书上207页的设置，CLKDIV和HSPCLKDIV的值按道理都设置000，这样TBCLK的频率为系统时钟频率150MHz，但是用CCS代码epwm初始化设置000，000之后出来的频率不是12.8kHz。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EPwm1Regs.TBCTL.bit.HSPCLKDIV &#x3D;0;&#x2F;&#x2F;1 TB_DIV1;</span><br><span class="line">EPwm1Regs.TBCTL.bit.CLKDIV &#x3D; 1;&#x2F;&#x2F;2  75M</span><br><span class="line">别人都设置为这样的值，出来就是正确的频率…</span><br></pre></td></tr></table></figure>
<p>TBCLK=SYSCLKOUT/(HSPCLKDIV×CLKDIV)，Matlab的HSPCLKDIV和CLKDIV我都设置成1，也就是不分频，那么TBCLK的频率才是150MHz，这样增减模式下Tpwm=2<em>TBPRD</em>TBCLK，TBPRD的值为5859，但是都设置不分频出来的示波器PWM频率显示是25.6kHz，不知道为啥…观察一个PWM的周期值是正确的，不知道是不是示波器没设置好；</p>
<p>将CCS自己的编程的代码进行了整理，编程不写注释，就和拉屎不擦屁股是一样的！写代码一定要写注释！目前自己写的代码还没有编译成功，还要继续努力修改代码……</p>
<h2 id="一些感悟🤯"><a href="#一些感悟🤯" class="headerlink" title="一些感悟🤯"></a>一些感悟🤯</h2><p>今天上午我另一个教研室老师把一个师兄骂惨了，腾讯会议汇报啥都没做，说叫他退学，腾讯会议汇报啥都没做，好像不是一次两次，老师想把他辞了，叫那个师兄申请休学或退学，不要浪费大好青春，喜欢打游戏就去做游戏主播挣钱。所以研究生真的不能摸鱼啊，不然导师就给辞退了！</p>
<h2 id="我的书单📚"><a href="#我的书单📚" class="headerlink" title="我的书单📚"></a>我的书单📚</h2><p>突然发现自己好像读了不少书，虽然感觉没啥用，包括专业书已经差不多快一百多本了，每读完一本书我都会记录下读过的书籍封面并且保存自己的读书笔记。</p>
<p>这是自己的读过的书籍整理：<a target="_blank" rel="noopener" href="https://reinvented-star-45f.notion.site/6ec651c06b2a4e388acd240a55a9ccba?v=c56fde318a834f93ad18770a10a2a3b7">我的读书摘记</a></p>
<p>这是我收集的课外书籍电子书：<a target="_blank" rel="noopener" href="https://reinvented-star-45f.notion.site/63d59fb3e36a4f2ebdc39fb2b8e217da?v=34fa3d60453e4702954b4cb5c42d525e">一些课外电子书资源</a></p>
<p>最近读完了《被讨厌的勇气》，这是《被讨厌的勇气》的读书笔记：<a target="_blank" rel="noopener" href="https://reinvented-star-45f.notion.site/da99268613ce41ef873e1987a55cb729">被讨厌的勇气读书摘记</a></p>
<p>然后开始读《认识经济》</p>
<p><img data-src="https://tva4.sinaimg.cn/large/0084Tjdoly1gtm55mogsej60rm13jtzm02.jpg" alt="迪恩·卡尔兰【认识经济】"></p>
<p>我把我看过的课外书（不包括自己的专业课的书）的封面进行了收集：</p>
<p><img data-src="https://tva1.sinaimg.cn/large/0084Tjdoly1gthi209e6jj617p0pq7wh02.jpg" alt="我的书单（截至20210822）"></p>
<p>坚持读书，提升自己的认知，保持内心的童真，做一个不世俗的人！</p>
<h2 id="休息娱乐✌"><a href="#休息娱乐✌" class="headerlink" title="休息娱乐✌"></a>休息娱乐✌</h2><p>最近看到一个非常棒的视频，1999年宝莲灯的动画片，起因是我听张信哲的《爱就一个字》，竟然发现这是动画片宝莲灯的主题曲；再去B站一搜竟然发现以前的宝莲灯配音阵容竟然有这么多名人，二郎神是姜文配音…孙悟空是陈佩斯配音…↓↓</p>
<iframe src="//player.bilibili.com/player.html?aid=969960654&bvid=BV11p4y1r7Hi&cid=244030022&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>1999 电影【大陆】《宝莲灯》b（￣▽￣）d　</p>
<iframe src="//player.bilibili.com/player.html?aid=8317208&bvid=BV1Js41187V8&cid=13686142&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>推荐纪录片徐童导演 游民三部曲《算命》《麦收》</p>
<iframe src="//player.bilibili.com/player.html?aid=5846667&bvid=BV1cs411k72E&cid=9494127&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<iframe src="//player.bilibili.com/player.html?aid=329458766&bvid=BV1RA411n7HL&cid=232382089&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>星期六发现了一款非常好用的安卓软件：李跳跳</p>
<p>它可以自动跳过安卓广告，真的非常好用！</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://wwe.lanzoui.com/iGC8fsyie8h">点我下载不给资本恰烂钱的机会</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://ncepuee.github.io/2021/08/15/20210809-0815/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="菜菜的黄">
      <meta itemprop="description" content="记录科研生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="School boy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/15/20210809-0815/" class="post-title-link" itemprop="url">20210809-0815周报</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-15 08:00:00" itemprop="dateCreated datePublished" datetime="2021-08-15T08:00:00+08:00">2021-08-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一周真的太快了！感觉自己有点笨，但是勉强还能学，每天脑汁都感觉榨干了🤦‍，果然脑力劳动是最累的，哎…，以下是一周个人总结（20210809-0815）</p>
<iframe frameborder="0" height="80" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;" src="//music.163.com/outchain/player?type=2&id=36392026&auto=0&height=66"></iframe>

<h2 id="运动歌单🎵"><a href="#运动歌单🎵" class="headerlink" title="运动歌单🎵"></a>运动歌单🎵</h2><p>适合跑步运动的歌单（Music）</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="450" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/playlist/running-fitness-sports/pl.u-Ldbqel5u27kmjlm"></iframe>

<h2 id="同门吃瓜🍉"><a href="#同门吃瓜🍉" class="headerlink" title="同门吃瓜🍉"></a>同门吃瓜🍉</h2><p>和师兄师姐其实也差不了几岁，感觉大家都是同龄人，人都非常好，疫情封校大家都不能回家，然后特别想吃西瓜</p>
<p>我和我同学就点了水果超市的外卖，外卖三十起送，于是就买了一个大西瓜。</p>
<p>和师兄师姐一起分着吃，哈哈哈哈，一起吃瓜才爽，给另外一个老师的师兄们也送了西瓜吃😂，然后终于把一个三十多斤的大西瓜分完了！</p>
<p><img data-src="https://tvax2.sinaimg.cn/large/0084Tjdoly1gt9o0gaojyj31400u0jvk.jpg" alt="吃瓜图🍉"></p>
<h2 id="学习进展📕"><a href="#学习进展📕" class="headerlink" title="学习进展📕"></a>学习进展📕</h2><p>效率属实不高/(ㄒoㄒ)/~~</p>
<p>星期一、星期二：看完了DSP芯片的ePWM模块的介绍，了解了各个模块的实际作用，以及对寄存器的各位信息表进行了了解，感觉啥都没看懂…还是要进行实际的编程才能慢慢理解！</p>
<p>星期三：看完了DSP芯片的芯片资源、时钟电路及系统控制、存储器及其地址分配。都是大概了解下，实在是看不懂，还是觉得要实际做一个工程才能深入了解其原理。</p>
<p>星期四：不想看视频了，看了如何建立一个CCS工程Project文件后怎么初始化设置库文件和源文件。在笔记软件中记录了YouTuber的印度人的教程，只要每次新建Project工程，都需要这样操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">首先右键项目，新建一个文件夹</span><br><span class="line"></span><br><span class="line">在弹出的选项框中，选择&#96;Advanced&#96;，选择&#96;Link to alternate location(Linked Folder)&#96;</span><br><span class="line"></span><br><span class="line">选择&#96;Browse…&#96;，找到以下文件夹：ti→controlSUITE→device_support→f2833x→v142→DSP2833x_common文件夹，点击OK，之后点击Finish，完整路径：D:\ti\controlSUITE\device_support\f2833x\v142\DSP2833x_common</span><br><span class="line"></span><br><span class="line">之后会在Project项目中导入DSP2833x_common文件夹</span><br><span class="line"></span><br><span class="line">DSP2833x_common文件夹下有好几个文件夹，我们只需要include文件夹和source文件夹，选择其他的文件夹，右键点击&#96;Exclude from Build&#96;</span><br><span class="line"></span><br><span class="line">同理再新建一个文件夹，选择&#96;Browse…&#96;，找到以下文件夹：ti→controlSUITE→device_support→f2833x→v142→DSP2833x_headers文件夹，点击OK，点击Finish，即可导入该文件夹。</span><br><span class="line"></span><br><span class="line">DSP2833x_headers文件夹下有四个文件夹，我们只需要保留include文件夹和source文件夹，将gel文件夹Exclude from Build，选择cmd文件夹下的第一个cmd文件&#96;DSP2833x_Headers_BIOS.cmd&#96;文件，将其Exclude from Build。只保留&#96;DSP2833x_Headers_nonBIOS.cmd&#96;文件。</span><br><span class="line"></span><br><span class="line">然后找到DSP2833x_common文件夹下的source文件夹下的&#96;DSP2833x_SWPrioritizedDefaultsr.c&#96;文件和&#96;DSP2833x_SWPrioritizedPieVect.c&#96;文件，将两个文件Exclude from Build。</span><br><span class="line"></span><br><span class="line">之后自己再新建一个include文件夹和src文件夹分别存放自己定义的库文件和源文件，即 &#96;.h&#96; 和 &#96;.c&#96; 的后缀文件</span><br><span class="line"></span><br><span class="line">在CCS Project右键选择&#96;Properties&#96;，选择&#96;General&#96;下的&#96;Product&#96;，取消勾选&#96;XDAIS&#96;，再在&#96;Include Options&#96;把DSP2833x_common文件夹下的include文件夹和DSP2833x_headers文件夹下的include文件夹以及自己定义的include文件夹的路径添加到变量。</span><br><span class="line"></span><br><span class="line">最后右键点击Build Project即可成功编译生成烧写.out文件！</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果运行出现这个报错：#10234-D: unresolved symbols remain；说明是源文件出错了！查看源文件是否写对了！</p>
</blockquote>
<p>查找了基于TMS320F28335的SVPWM算法的一些论文↓↓</p>
<p><img data-src="https://tva2.sinaimg.cn/large/0084Tjdoly1gtec05ith6j60ri0hnk9v02.jpg" alt="一些不详细的论文"></p>
<p>星期五：将SVPWM代码进行了撰写和分析……</p>
<h2 id="实用工具🔧"><a href="#实用工具🔧" class="headerlink" title="实用工具🔧"></a>实用工具🔧</h2><p>把做毕业设计时候自己做的学校的论文模板作为自己的科研笔记本😀，感觉还行，如果朋友们也需要欢迎下载~</p>
<p>School boy的科研笔记本 =&gt; <a target="_blank" rel="noopener" href="https://wwe.lanzoui.com/inE3vsh6reh">笔记本模板</a></p>
<p>笔记本模板的标题格式、目录、题注等等都全部按照自己的学校要求设置好了，所以只需要写东西记录即可！</p>
<h2 id="疫情生活🏫"><a href="#疫情生活🏫" class="headerlink" title="疫情生活🏫"></a>疫情生活🏫</h2><p>因为疫情，学校不准出门，只能待在学校，然后学校食堂暑假每天早上7:30-8:30、中午11:30-12:30、晚上5:30-6:30才供应，所以每天早上都需要定时起来，笑拉了，不过想想这样可以规律一点也挺不错的。</p>
<p>由于不能出校门，又想吃水果，所以只能点外卖，每次都要点满30元，因为三十起送…😂</p>
<p>学校的菜过于难吃，就和我的新的室友们一起买了绝味鸭脖，味道针不错，吃了好多饭哈哈哈哈（学校的菜什么时候能变一变😭）</p>
<h2 id="关于午睡💤"><a href="#关于午睡💤" class="headerlink" title="关于午睡💤"></a>关于午睡💤</h2><p>我觉得午睡现在对我来说真的非常重要，现在精力感觉少了好多，睡了午觉感觉下午精神会好很多，就是有时候睡不着有点难受。还好学校比较小，寝室离实验室不是很远，每天中午都可以睡午觉，还挺好的。</p>
<h2 id="校园运动🏃‍"><a href="#校园运动🏃‍" class="headerlink" title="校园运动🏃‍"></a>校园运动🏃‍</h2><p>朋友们一定不要久坐，每天久坐导致腰部酸痛，所以每天一定要运动下，很伤心我们实验室的师兄都不打球🏀，也不喜欢运动，还好我同一届的同学会运动下，有时候跑步，有时候篮球，有时候会叫上师兄打羽毛球🤦‍（没错必须我叫师兄才会去）</p>
<p>热知识：我师兄是我江西老表~</p>
<h2 id="学生票👨‍🎓"><a href="#学生票👨‍🎓" class="headerlink" title="学生票👨‍🎓"></a>学生票👨‍🎓</h2><p>突然发现现在去景区已经没有学生票了！我以为研究生还可以算学生票，好想哭，半价啊！好像只有买火车票才有学生票了…呜呜呜。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://ncepuee.github.io/2021/08/08/20210808/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="菜菜的黄">
      <meta itemprop="description" content="记录科研生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="School boy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/08/20210808/" class="post-title-link" itemprop="url">重新出发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-08 08:00:00" itemprop="dateCreated datePublished" datetime="2021-08-08T08:00:00+08:00">2021-08-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>2021年8月8日</p>
<iframe frameborder="0" height="80" style="width:100%;max-width:1080px;overflow:hidden;background:transparent;" src="//music.163.com/outchain/player?type=2&id=454698657&auto=0&height=66"></iframe>

<p>最近好像做了很多事情，又好像什么都没有做🤦‍，突然发现好久没弄博客了，想着就每周更新一篇自己的学习生活吧。</p>
<p>知乎关注我的人有点多，都不想发啥了，还是要给自己留个“私密空间”哈哈哈哈，这个博客主要是想要更新自己的状态，以及一些生活啥的，最近都没怎么看微信了，每天都是看电脑，有空就码码字嘻嘻，就这样吧！希望接下来能专注科研，不开心就在博客上码码字，抱怨下嘿嘿🤭</p>
<p>看到同学分享的这个视频觉得还不错↓↓</p>
<iframe src="//player.bilibili.com/player.html?bvid=BV1a64y1W76X&cid=380546070&page=1" scrolling="no" border="0" frameborder="no" framespacing="0"></iframe>

<p>溜了溜了，搞学习去了，都加油啊！</p>
<blockquote>
<p>如果让我必须在那种由老师管着、选够学分就能毕业的大学和那种没有教授、考试，让年轻人在一起共同生活、互相学习三四年的大学中选择一种，我将毫不犹豫地选择后者……为什么呢？我是这样想的：当许多聪明、求知欲强、富有同情心而又目光敏锐的年轻人聚到一起，即使没有人教，他们也能互相学习。他们互相交流，了解到新的思想和看法，看到新鲜事物并且掌握独到的行为判断力。——英国教育家、牛津主教约翰·纽曼</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">菜菜的黄</span>
</div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-601e7b328682665a" async="async"></script>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  




  





</body>
</html>
